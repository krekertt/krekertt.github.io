// –í –Ω–∞—á–∞–ª–µ script –¥–æ–±–∞–≤—å—Ç–µ:
const API_URL = 'http://localhost:3000/api';
let token = localStorage.getItem('token');

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
async function apiRequest(endpoint, method = 'GET', data = null) {
  const headers = {
    'Content-Type': 'application/json'
  };
  
  if (token) {
    headers['Authorization'] = `Bearer ${token}`;
  }
  
  const options = {
    method,
    headers
  };
  
  if (data) {
    options.body = JSON.stringify(data);
  }
  
  const response = await fetch(`${API_URL}${endpoint}`, options);
  const result = await response.json();
  
  if (!response.ok) {
    throw new Error(result.error || 'API Error');
  }
  
  return result;
}

// –ü–µ—Ä–µ–¥–µ–ª–∞–π—Ç–µ registerUser –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
async function registerUser() {
  const name = document.getElementById('registerName').value.trim();
  const lastName = document.getElementById('registerLastName').value.trim();
  const username = document.getElementById('registerUsername').value.trim();
  const phone = '+7 999 123-45-67';

  if (!name) {
    document.getElementById('registerError').innerText = '–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ';
    return;
  }

  try {
    const result = await apiRequest('/register', 'POST', {
      name, lastName, username, phone
    });
    
    currentUser = result.user;
    token = result.token;
    localStorage.setItem('token', token);
    
    document.getElementById('registerModal').classList.remove('active');
    finishAuth();
  } catch (error) {
    document.getElementById('registerError').innerText = error.message;
  }
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlaxGram ‚ú¶ Xost Bots + BotFather + Gift —Å—Å—ã–ª–∫–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }

        :root {
            --bg-dark: #0b141a;
            --bg-sidebar: #17212b;
            --bg-chat: #0b141a;
            --bg-input: #1f2c3a;
            --bg-hover: #2b3b4a;
            --accent: #2a6c9e;
            --accent-light: #3a7cb0;
            --text-white: #ffffff;
            --text-gray: #8e9caa;
            --text-muted: #5f727f;
            --border: #1f2f3a;
            --online: #2ecc71;
            --error: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --star: #f1c40f;
            --bot: #6e5cb6;
            --premium: #ffd700;
            --premium-bg: linear-gradient(135deg, #f1c40f, #e67e22);
            --xost: #00bcd4;
            --xost-dark: #008c9e;
        }

        body {
            background: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
            transition: 0.2s;
        }

        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .blaxgram-app {
            width: 1300px;
            height: 850px;
            background: var(--bg-sidebar);
            border-radius: 16px;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.6);
            display: flex;
            overflow: hidden;
            border: 1px solid var(--border);
            position: relative;
        }

        /* –≠–ö–†–ê–ù –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò */
        .auth-container {
            width: 100%;
            height: 100%;
            background: var(--bg-sidebar);
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
            transition: 0.3s;
        }

        .auth-card {
            width: 400px;
            background: var(--bg-dark);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid var(--border);
        }

        .auth-logo {
            font-size: 48px;
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent);
        }

        .auth-title {
            color: var(--text-white);
            font-size: 28px;
            font-weight: 500;
            text-align: center;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            color: var(--text-gray);
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .auth-input {
            width: 100%;
            padding: 15px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-white);
            font-size: 16px;
            margin-bottom: 15px;
        }

        .auth-input:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--bg-hover);
        }

        .auth-btn {
            width: 100%;
            padding: 15px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            margin-bottom: 15px;
        }

        .auth-btn:hover {
            background: var(--accent-light);
        }

        .auth-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .auth-link {
            color: var(--text-gray);
            text-align: center;
            font-size: 14px;
        }

        .auth-link span {
            color: var(--accent);
            cursor: pointer;
        }

        .code-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 25px 0;
        }

        .code-digit {
            width: 50px;
            height: 60px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-white);
            font-size: 24px;
            text-align: center;
            line-height: 60px;
        }

        .error-text {
            color: var(--error);
            font-size: 13px;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        /* –û–°–ù–û–í–ù–û–ô –ò–ù–¢–ï–†–§–ï–ô–° (—Å–∫—Ä—ã—Ç –ø–æ–∫–∞ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–ª–∏—Å—å) */
        .main-interface {
            display: flex;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: 0.3s;
        }

        /* –õ–µ–≤—ã–π —Å–∞–π–¥–±–∞—Ä */
        .sidebar {
            width: 70px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            gap: 15px;
        }

        .sidebar-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-gray);
            font-size: 24px;
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }

        .sidebar-icon:hover {
            background: var(--bg-hover);
            color: white;
        }

        .sidebar-icon.active {
            background: var(--accent);
            color: white;
            border-radius: 16px;
        }

        .avatar-small {
            width: 45px;
            height: 45px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            margin-top: auto;
            position: relative;
        }

        .premium-badge-small {
            position: absolute;
            bottom: -2px;
            right: -2px;
            background: var(--premium-bg);
            color: white;
            font-size: 12px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-sidebar);
        }

        .xost-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--xost);
            color: white;
            font-size: 10px;
            padding: 2px 4px;
            border-radius: 10px;
            border: 1px solid var(--bg-sidebar);
        }

        /* –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ */
        .chats-panel {
            width: 320px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .chats-header {
            padding: 15px 15px 10px;
            border-bottom: 1px solid var(--border);
        }

        .chats-header h2 {
            color: white;
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .chats-search {
            background: var(--bg-input);
            border: none;
            padding: 12px 15px;
            border-radius: 25px;
            color: white;
            width: 100%;
            font-size: 14px;
        }

        .chats-search::placeholder {
            color: var(--text-muted);
        }

        .chats-tabs {
            display: flex;
            padding: 15px 15px 0;
            gap: 15px;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            color: var(--text-gray);
            padding-bottom: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }

        .tab.active {
            color: var(--accent);
            border-bottom: 2px solid var(--accent);
        }

        .chats-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .chat-item {
            padding: 10px 15px;
            display: flex;
            gap: 12px;
            cursor: pointer;
            transition: 0.1s;
        }

        .chat-item:hover {
            background: var(--bg-hover);
        }

        .chat-item.active {
            background: var(--accent);
        }

        .chat-avatar {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            background: var(--accent);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            position: relative;
        }

        .bot-badge {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            background: var(--bot);
            border-radius: 50%;
            border: 2px solid var(--bg-sidebar);
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .online-badge {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--online);
            border-radius: 50%;
            border: 2px solid var(--bg-sidebar);
        }

        .premium-badge {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            background: var(--premium-bg);
            border-radius: 50%;
            border: 2px solid var(--bg-sidebar);
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .chat-info {
            flex: 1;
        }

        .chat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .chat-name {
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .bot-tag {
            background: var(--bot);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .premium-tag {
            background: var(--premium-bg);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .xost-tag {
            background: var(--xost);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .chat-time {
            color: var(--text-gray);
            font-size: 12px;
        }

        .chat-preview {
            color: var(--text-gray);
            font-size: 13px;
            display: flex;
            justify-content: space-between;
        }

        .unread-count {
            background: var(--accent);
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-chat);
        }

        .chat-header {
            padding: 12px 20px;
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            position: relative;
        }

        .header-info {
            flex: 1;
        }

        .header-name {
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .verified {
            color: var(--accent);
            font-size: 16px;
        }

        .premium-icon {
            color: var(--premium);
            font-size: 16px;
        }

        .header-status {
            color: var(--text-gray);
            font-size: 13px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            color: var(--text-gray);
            font-size: 22px;
        }

        .header-actions span {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
        }

        .header-actions span:hover {
            background: var(--bg-hover);
        }

        /* –°–æ–æ–±—â–µ–Ω–∏—è */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--bg-chat);
            background-image: radial-gradient(#1f3a4a 1px, transparent 1px);
            background-size: 30px 30px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .date-divider {
            text-align: center;
            margin: 15px 0;
        }

        .date-divider span {
            background: var(--bg-input);
            color: var(--text-gray);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
        }

        .message-wrapper {
            display: flex;
            max-width: 70%;
            flex-direction: column;
            position: relative;
        }

        .message-wrapper.outgoing {
            margin-left: auto;
        }

        /* –¶–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ */
        .reply-context {
            background: var(--bg-input);
            border-left: 3px solid var(--accent);
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 5px;
            font-size: 12px;
            color: var(--text-gray);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
        }

        .reply-context:hover {
            background: var(--bg-hover);
        }

        .reply-badge {
            background: var(--accent);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            margin-left: 5px;
        }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º */
        .message-actions {
            position: absolute;
            top: -20px;
            right: 0;
            background: var(--bg-sidebar);
            border-radius: 20px;
            padding: 5px;
            display: none;
            gap: 5px;
            border: 1px solid var(--border);
            z-index: 10;
        }

        .message-wrapper:hover .message-actions {
            display: flex;
        }

        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--bg-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            color: white;
        }

        .action-btn:hover {
            background: var(--accent);
        }

        .message-bubble {
            padding: 8px 12px;
            border-radius: 14px;
            position: relative;
            word-break: break-word;
        }

        .incoming .message-bubble {
            background: var(--bg-input);
            color: white;
            border-top-left-radius: 4px;
        }

        .outgoing .message-bubble {
            background: var(--accent);
            color: white;
            border-top-right-radius: 4px;
        }

        .message-text {
            font-size: 14px;
            margin-right: 40px;
            line-height: 1.4;
        }

        .edited-badge {
            font-size: 10px;
            color: rgba(255,255,255,0.5);
            margin-left: 5px;
            font-style: italic;
        }

        .message-meta {
            position: absolute;
            bottom: 4px;
            right: 8px;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            display: flex;
            gap: 3px;
        }

        /* –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–æ–±—ã—á–Ω—ã–µ) */
        .message-reactions {
            display: flex;
            gap: 4px;
            margin-top: 4px;
            margin-left: 8px;
            flex-wrap: wrap;
        }

        .reaction {
            background: var(--bg-input);
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 13px;
            color: white;
            display: flex;
            align-items: center;
            gap: 3px;
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .reaction.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        /* –ó–≤–µ–∑–¥–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏ (–¥–ª—è –∫–∞–Ω–∞–ª–æ–≤) */
        .star-reaction {
            background: var(--star);
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 13px;
            color: black;
            display: flex;
            align-items: center;
            gap: 3px;
            cursor: pointer;
            border: 1px solid var(--star);
            font-weight: 500;
        }

        .star-reaction-total {
            background: var(--bg-input);
            border-radius: 20px;
            padding: 2px 8px;
            font-size: 13px;
            color: var(--star);
            display: flex;
            align-items: center;
            gap: 3px;
            margin-top: 4px;
        }

        .reaction-picker {
            display: flex;
            gap: 5px;
            background: var(--bg-sidebar);
            border-radius: 30px;
            padding: 5px;
            position: absolute;
            bottom: 100%;
            right: 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            display: none;
        }

        .message-wrapper:hover .reaction-picker {
            display: flex;
        }

        .reaction-emoji {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }

        .reaction-emoji:hover {
            background: var(--bg-hover);
        }

        .star-reaction-picker {
            display: flex;
            gap: 5px;
            background: var(--bg-sidebar);
            border-radius: 30px;
            padding: 10px;
            position: absolute;
            bottom: 100%;
            right: 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            display: none;
            flex-wrap: wrap;
            width: 200px;
        }

        .message-wrapper:hover .star-reaction-picker {
            display: flex;
        }

        .star-amount {
            background: var(--bg-input);
            border-radius: 20px;
            padding: 5px 10px;
            font-size: 14px;
            color: var(--star);
            cursor: pointer;
            border: 1px solid var(--border);
        }

        .star-amount:hover {
            background: var(--accent);
            color: white;
        }

        /* –§–∞–π–ª—ã */
        .file-attachment {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 12px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .file-icon {
            font-size: 24px;
        }

        .file-name {
            font-size: 13px;
            color: white;
        }

        .file-size {
            font-size: 11px;
            color: var(--text-gray);
        }

        /* Gift —Å—Å—ã–ª–∫–∞ */
        .gift-link {
            background: linear-gradient(135deg, #f1c40f20, #e67e2220);
            border: 1px solid var(--star);
            border-radius: 8px;
            padding: 8px 12px;
            margin-top: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .gift-link-icon {
            font-size: 24px;
        }

        .gift-link-code {
            font-family: monospace;
            color: var(--star);
            font-size: 12px;
        }

        .gift-link-expires {
            font-size: 10px;
            color: var(--text-gray);
        }

        /* –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ */
        .bot-commands {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 10px;
            margin-top: 5px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
        }

        .bot-command {
            background: var(--bg-hover);
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            color: white;
            cursor: pointer;
        }

        .bot-command:hover {
            background: var(--accent);
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .input-area {
            padding: 15px 20px;
            background: var(--bg-sidebar);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .attach-btn, .emoji-btn, .sticker-btn, .star-btn, .gift-btn, .bot-btn, .gift-link-btn {
            color: var(--text-gray);
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            position: relative;
        }

        .attach-btn:hover, .emoji-btn:hover, .sticker-btn:hover, .star-btn:hover, .gift-btn:hover, .bot-btn:hover, .gift-link-btn:hover {
            background: var(--bg-hover);
        }

        .star-balance {
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--bg-input);
            padding: 5px 12px;
            border-radius: 20px;
            color: var(--star);
            font-weight: 500;
            cursor: pointer;
        }

        .star-balance:hover {
            background: var(--bg-hover);
        }

        .message-input {
            flex: 1;
            background: var(--bg-input);
            border: none;
            padding: 12px 18px;
            border-radius: 25px;
            color: white;
            font-size: 15px;
        }

        .message-input:focus {
            outline: none;
            background: var(--bg-hover);
        }

        .send-btn {
            color: var(--accent);
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .send-btn:hover {
            background: var(--bg-hover);
        }

        /* –°—Ç–∏–∫–µ—Ä—ã */
        .sticker-panel {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 350px;
            height: 400px;
            background: var(--bg-sidebar);
            border-radius: 16px;
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .sticker-panel.active {
            display: flex;
        }

        .sticker-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
        }

        .sticker-header h3 {
            color: white;
        }

        .sticker-tabs {
            display: flex;
            gap: 10px;
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
        }

        .sticker-tab {
            color: var(--text-gray);
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 15px;
        }

        .sticker-tab.active {
            background: var(--accent);
            color: white;
        }

        .sticker-grid {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .sticker-item {
            aspect-ratio: 1;
            background: var(--bg-input);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
        }

        .sticker-item:hover {
            background: var(--bg-hover);
        }

        /* –ü–∞–Ω–µ–ª—å –∑–≤–µ–∑–¥ */
        .stars-panel {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 350px;
            height: 450px;
            background: var(--bg-sidebar);
            border-radius: 16px;
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .stars-panel.active {
            display: flex;
        }

        .stars-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stars-header h3 {
            color: white;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stars-balance-large {
            background: var(--bg-input);
            padding: 8px 15px;
            border-radius: 30px;
            color: var(--star);
            font-weight: 500;
            font-size: 18px;
        }

        .stars-grid {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .star-item {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 15px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .star-item:hover {
            background: var(--bg-hover);
            border-color: var(--star);
        }

        .star-icon {
            font-size: 30px;
            color: var(--star);
        }

        .star-value {
            color: white;
            font-weight: 500;
        }

        /* –ü–∞–Ω–µ–ª—å –ø–æ–¥–∞—Ä–∫–æ–≤ */
        .gifts-panel {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 380px;
            height: 450px;
            background: var(--bg-sidebar);
            border-radius: 16px;
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .gifts-panel.active {
            display: flex;
        }

        .gifts-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .gifts-header h3 {
            color: white;
            margin-bottom: 5px;
        }

        .gifts-balance {
            color: var(--star);
            font-size: 14px;
        }

        .gifts-grid {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .gift-item {
            background: var(--bg-input);
            border-radius: 16px;
            padding: 15px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .gift-item:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
        }

        .gift-icon {
            font-size: 36px;
        }

        .gift-name {
            color: white;
            font-size: 13px;
            text-align: center;
        }

        .gift-price {
            color: var(--star);
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        /* –ü–∞–Ω–µ–ª—å Gift —Å—Å—ã–ª–æ–∫ */
        .gift-links-panel {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 400px;
            height: 450px;
            background: var(--bg-sidebar);
            border-radius: 16px;
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .gift-links-panel.active {
            display: flex;
        }

        .gift-links-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .gift-links-header h3 {
            color: white;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .gift-links-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .gift-link-item {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
        }

        .gift-link-item.active {
            border-color: var(--star);
        }

        .gift-link-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .gift-link-creator {
            color: white;
            font-weight: 500;
        }

        .gift-link-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .status-active {
            background: var(--success);
            color: white;
        }

        .status-used {
            background: var(--error);
            color: white;
        }

        .gift-link-code-display {
            font-family: monospace;
            color: var(--star);
            font-size: 14px;
            margin: 8px 0;
            word-break: break-all;
        }

        .gift-link-expires {
            color: var(--text-gray);
            font-size: 12px;
            margin-bottom: 8px;
        }

        .gift-link-activator {
            color: var(--text-gray);
            font-size: 12px;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid var(--border);
        }

        .create-gift-link-btn {
            background: var(--star);
            color: black;
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            margin: 0 15px 15px;
        }

        .create-gift-link-btn:hover {
            opacity: 0.9;
        }

        .create-gift-link-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* –ü–∞–Ω–µ–ª—å –±–æ—Ç–æ–≤ */
        .bots-panel {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 400px;
            height: 500px;
            background: var(--bg-sidebar);
            border-radius: 16px;
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .bots-panel.active {
            display: flex;
        }

        .bots-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bots-header h3 {
            color: white;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .bots-header h3::before {
            content: 'ü§ñ';
            margin-right: 5px;
        }

        .bots-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .bot-item {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .bot-item:hover {
            background: var(--bg-hover);
            border-color: var(--bot);
        }

        .bot-item-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .bot-avatar {
            width: 40px;
            height: 40px;
            background: var(--bot);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .bot-info {
            flex: 1;
        }

        .bot-name {
            color: white;
            font-weight: 500;
        }

        .bot-username {
            color: var(--text-gray);
            font-size: 12px;
        }

        .bot-description {
            color: var(--text-gray);
            font-size: 13px;
            margin-top: 5px;
        }

        .bot-token {
            background: var(--bg-dark);
            padding: 8px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            color: var(--accent);
            margin-top: 5px;
            display: none;
        }

        .bot-token.show {
            display: block;
        }

        .bot-stats {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            color: var(--text-gray);
            font-size: 12px;
        }

        .bot-stat {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        /* Xost Bots –ø–∞–Ω–µ–ª—å */
        .xost-panel {
            position: absolute;
            bottom: 80px;
            right: 20px;
            width: 500px;
            height: 600px;
            background: var(--bg-sidebar);
            border-radius: 16px;
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            z-index: 1000;
        }

        .xost-panel.active {
            display: flex;
        }

        .xost-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--xost);
            color: white;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
        }

        .xost-header h3 {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .xost-header h3::before {
            content: '‚ö°';
        }

        .xost-close {
            cursor: pointer;
            font-size: 20px;
        }

        .xost-tabs {
            display: flex;
            padding: 10px 15px;
            gap: 15px;
            border-bottom: 1px solid var(--border);
        }

        .xost-tab {
            color: var(--text-gray);
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 15px;
        }

        .xost-tab:hover {
            background: var(--bg-hover);
        }

        .xost-tab.active {
            background: var(--xost);
            color: white;
        }

        .xost-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .xost-bot-item {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid transparent;
        }

        .xost-bot-item.running {
            border-left-color: var(--success);
        }

        .xost-bot-item.stopped {
            border-left-color: var(--text-gray);
        }

        .xost-bot-item.error {
            border-left-color: var(--error);
        }

        .xost-bot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .xost-bot-name {
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .xost-bot-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .status-running {
            background: var(--success);
            color: white;
        }

        .status-stopped {
            background: var(--text-gray);
            color: white;
        }

        .status-error {
            background: var(--error);
            color: white;
        }

        .xost-bot-stats {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            color: var(--text-gray);
            font-size: 12px;
        }

        .xost-bot-stat {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .xost-bot-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .xost-btn {
            padding: 5px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }

        .xost-btn.start {
            background: var(--success);
            color: white;
        }

        .xost-btn.stop {
            background: var(--error);
            color: white;
        }

        .xost-btn.restart {
            background: var(--warning);
            color: black;
        }

        .xost-btn.logs {
            background: var(--xost);
            color: white;
        }

        .xost-bot-warning {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid var(--error);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 12px;
            color: var(--error);
        }

        .xost-create-form {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 20px;
        }

        .xost-form-group {
            margin-bottom: 15px;
        }

        .xost-form-label {
            color: white;
            margin-bottom: 5px;
            display: block;
        }

        .xost-form-input {
            width: 100%;
            padding: 10px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: white;
        }

        .xost-form-select {
            width: 100%;
            padding: 10px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: white;
        }

        .xost-form-textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: white;
            font-family: monospace;
            resize: vertical;
        }

        .xost-file-upload {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .xost-file-upload:hover {
            border-color: var(--xost);
        }

        .xost-create-btn {
            background: var(--xost);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            font-weight: 500;
            cursor: pointer;
        }

        .xost-create-btn:hover {
            background: var(--xost-dark);
        }

        .xost-create-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .xost-logs {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            color: var(--text-gray);
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .xost-log-line {
            margin-bottom: 3px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 3px;
        }

        .xost-log-time {
            color: var(--xost);
            margin-right: 10px;
        }

        .xost-balance {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--star);
            font-size: 14px;
            margin-left: 15px;
        }

        .xost-warning {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
            color: var(--warning);
        }

        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (–∏–Ω—Ñ–æ) */
        .info-panel {
            width: 280px;
            background: var(--bg-sidebar);
            border-left: 1px solid var(--border);
            padding: 20px;
            overflow-y: auto;
        }

        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .info-header h3 {
            color: white;
            font-weight: 500;
        }

        .close-info {
            color: var(--text-gray);
            cursor: pointer;
            font-size: 20px;
        }

        .profile-avatar-large {
            width: 120px;
            height: 120px;
            background: var(--accent);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            position: relative;
        }

        .premium-badge-large {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--premium-bg);
            color: white;
            font-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--bg-sidebar);
        }

        .profile-name {
            color: white;
            font-size: 20px;
            font-weight: 500;
            text-align: center;
            margin-bottom: 5px;
        }

        .profile-username {
            color: var(--accent);
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .profile-bio {
            color: var(--text-gray);
            text-align: center;
            margin-bottom: 25px;
            padding: 0 10px;
            font-size: 14px;
        }

        .info-section {
            border-top: 1px solid var(--border);
            padding: 15px 0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            color: var(--text-gray);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .info-label {
            color: var(--text-muted);
        }

        .info-value {
            color: white;
        }

        .info-xost-btn {
            background: var(--xost);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 12px;
            width: 100%;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-top: 15px;
        }

        .info-xost-btn:hover {
            background: var(--xost-dark);
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 10px;
        }

        .media-item {
            aspect-ratio: 1;
            background: var(--bg-input);
            border-radius: 8px;
        }

        .gifts-profile {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .gift-profile-item {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: calc(33.33% - 7px);
        }

        .gift-profile-icon {
            font-size: 24px;
        }

        .gift-profile-name {
            color: var(--text-gray);
            font-size: 11px;
            text-align: center;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            width: 450px;
            background: var(--bg-sidebar);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border);
        }

        .modal-title {
            color: white;
            font-size: 22px;
            margin-bottom: 20px;
        }

        .modal-input {
            width: 100%;
            padding: 14px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: white;
            margin-bottom: 15px;
        }

        .radio-group {
            margin: 15px 0;
            color: var(--text-gray);
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .modal-btn.primary {
            background: var(--accent);
            color: white;
        }

        .modal-btn.secondary {
            background: var(--bg-input);
            color: white;
        }

        .modal-btn.danger {
            background: var(--error);
            color: white;
        }

        .modal-btn.star {
            background: var(--star);
            color: black;
        }

        .modal-btn.bot {
            background: var(--bot);
            color: white;
        }

        .modal-btn.premium {
            background: var(--premium-bg);
            color: black;
        }

        .modal-btn.xost {
            background: var(--xost);
            color: white;
        }

        /* Gift —Å—Å—ã–ª–∫–∞ –º–æ–¥–∞–ª–∫–∞ */
        .gift-link-info {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
        }

        .gift-link-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-gray);
            font-size: 14px;
        }

        .gift-link-info-value {
            color: white;
            font-weight: 500;
        }

        .gift-link-code-box {
            background: var(--bg-dark);
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            color: var(--star);
            word-break: break-all;
            margin: 10px 0;
        }

        /* –ó–≤–µ–∑–¥–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –º–æ–¥–∞–ª–∫–∞ */
        .star-reaction-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .star-reaction-input input {
            flex: 1;
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: white;
        }

        /* –ó–≤–æ–Ω–∫–∏ */
        .call-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 600px;
            background: var(--bg-sidebar);
            border-radius: 20px;
            border: 1px solid var(--border);
            display: none;
            flex-direction: column;
            z-index: 2000;
            overflow: hidden;
        }

        .call-container.active {
            display: flex;
        }

        .call-header {
            padding: 20px;
            background: var(--bg-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .call-video {
            flex: 1;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .remote-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
        }

        .local-video {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            background: #2a2a2a;
            border-radius: 10px;
            border: 2px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }

        .call-controls {
            padding: 20px;
            background: var(--bg-dark);
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--bg-input);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
        }

        .call-btn:hover {
            background: var(--bg-hover);
        }

        .call-btn.end {
            background: var(--error);
            color: white;
        }

        .call-btn.end:hover {
            background: #c0392b;
        }

        .call-info {
            color: var(--text-gray);
            font-size: 14px;
            margin-top: 5px;
        }

        /* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è —Ñ–∞–π–ª–æ–≤ */
        #fileInput, #xostFileInput {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —á–∞—Ç–∞/–∫–∞–Ω–∞–ª–∞ -->
    <div class="modal" id="createModal">
        <div class="modal-content">
            <h2 class="modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç</h2>
            <input type="text" class="modal-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" id="newChatName">
            <input type="text" class="modal-input" placeholder="–Æ–∑–µ—Ä–Ω–µ–π–º (—Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å @)" id="newChatUsername" oninput="validateUsername(this)">
            <div id="usernameError" class="error-text"></div>
            
            <div class="radio-group">
                <div class="radio-item">
                    <input type="radio" name="chatType" value="private" checked id="typePrivate">
                    <label for="typePrivate">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç (ID: 1,2,3...)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" name="chatType" value="public" id="typePublic">
                    <label for="typePublic">–ü—É–±–ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª (ID: -100...)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" name="chatType" value="group" id="typeGroup">
                    <label for="typeGroup">–ì—Ä—É–ø–ø–∞ (ID: -4752...)</label>
                </div>
                <div class="radio-item">
                    <input type="radio" name="chatType" value="bot" id="typeBot">
                    <label for="typeBot">–ë–æ—Ç</label>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary" onclick="createChat()">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ (BotFather) -->
    <div class="modal" id="botFatherModal">
        <div class="modal-content" style="width: 500px;">
            <h2 class="modal-title">ü§ñ BotFather</h2>
            <div style="color: var(--text-gray); margin-bottom: 20px; font-size: 14px; background: var(--bg-input); padding: 15px; border-radius: 12px;">
                <p>–ü—Ä–∏–≤–µ—Ç! –Ø BotFather. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º.</p>
                <p style="margin-top: 10px;">–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã:</p>
                <p>/newbot - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞</p>
                <p>/mybots - –º–æ–∏ –±–æ—Ç—ã</p>
                <p>/setname - –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è –±–æ—Ç–∞</p>
                <p>/setdescription - –∏–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ</p>
                <p>/setuserpic - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</p>
                <p>/token - –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω</p>
                <p>/revoke - –æ—Ç–æ–∑–≤–∞—Ç—å —Ç–æ–∫–µ–Ω</p>
                <p>/deletebot - —É–¥–∞–ª–∏—Ç—å –±–æ—Ç–∞</p>
            </div>
            
            <input type="text" class="modal-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É (–Ω–∞–ø—Ä–∏–º–µ—Ä /newbot)" id="botCommand" onkeydown="if(event.key==='Enter') sendBotCommand()">
            
            <div id="botCommandResult" style="color: var(--text-gray); font-size: 13px; margin-bottom: 15px; max-height: 200px; overflow-y: auto;"></div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="modal-btn bot" onclick="sendBotCommand()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–æ—Ç–∞ -->
    <div class="modal" id="botSettingsModal">
        <div class="modal-content">
            <h2 class="modal-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞</h2>
            <input type="text" class="modal-input" placeholder="–ò–º—è –±–æ—Ç–∞" id="botName">
            <input type="text" class="modal-input" placeholder="–Æ–∑–µ—Ä–Ω–µ–π–º (—Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª., –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ 'bot')" id="botUsername" oninput="validateBotUsername(this)">
            <input type="text" class="modal-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" id="botDescription">
            <div id="botSettingsError" class="error-text"></div>
            
            <div style="margin: 10px 0;">
                <label style="color: white;">–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞):</label>
                <textarea class="modal-input" id="botCommands" rows="3" placeholder="start - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞&#10;help - –ü–æ–º–æ—â—å&#10;info - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn bot" onclick="saveBotSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–ø–µ—Ä–≤—ã–π –≤—Ö–æ–¥) -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <h2 class="modal-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <input type="text" class="modal-input" placeholder="–ò–º—è *" id="registerName">
            <input type="text" class="modal-input" placeholder="–§–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" id="registerLastName">
            <input type="text" class="modal-input" placeholder="–Æ–∑–µ—Ä–Ω–µ–π–º (—Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å @)" id="registerUsername" oninput="validateUsername(this)">
            <div id="registerError" class="error-text"></div>

            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="registerUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–∞—Ä–∫–∞ -->
    <div class="modal" id="confirmPurchaseModal">
        <div class="modal-content">
            <h2 class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
            <p style="color: white; margin-bottom: 20px;" id="purchaseText">–ö—É–ø–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫?</p>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary" onclick="confirmGiftPurchase()">–ö—É–ø–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Gift —Å—Å—ã–ª–∫–∏ -->
    <div class="modal" id="createGiftLinkModal">
        <div class="modal-content">
            <h2 class="modal-title">üéÅ –°–æ–∑–¥–∞—Ç—å Gift —Å—Å—ã–ª–∫—É</h2>
            <p style="color: var(--text-gray); margin-bottom: 15px;">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span style="color: var(--star); font-weight: 500;">100,000 ‚≠ê</span></p>
            <p style="color: var(--text-gray); margin-bottom: 20px; font-size: 13px;">–°—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –∞–∫—Ç–∏–≤–Ω–∞ 24 —á–∞—Å–∞. –ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –¥–∞—Å—Ç Premium —Å—Ç–∞—Ç—É—Å –Ω–∞ 30 –¥–Ω–µ–π.</p>
            
            <div style="background: var(--bg-input); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: var(--text-gray);">–í–∞—à –±–∞–ª–∞–Ω—Å:</span>
                    <span style="color: var(--star); font-weight: 500;" id="createGiftBalance">0 ‚≠ê</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span style="color: var(--text-gray);">–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
                    <span style="color: var(--star); font-weight: 500;" id="createGiftBalanceAfter">0 ‚≠ê</span>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn star" onclick="createGiftLink()" id="createGiftBtn">–°–æ–∑–¥–∞—Ç—å –∑–∞ 100,000 ‚≠ê</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ Gift —Å—Å—ã–ª–∫–∏ -->
    <div class="modal" id="viewGiftLinkModal">
        <div class="modal-content">
            <h2 class="modal-title">üéÅ Gift —Å—Å—ã–ª–∫–∞</h2>
            
            <div class="gift-link-info">
                <div class="gift-link-info-row">
                    <span>–°–æ–∑–¥–∞—Ç–µ–ª—å:</span>
                    <span class="gift-link-info-value" id="viewGiftCreator">@username</span>
                </div>
                <div class="gift-link-info-row">
                    <span>–°—Ç–∞—Ç—É—Å:</span>
                    <span class="gift-link-info-value" id="viewGiftStatus">–ê–∫—Ç–∏–≤–Ω–∞</span>
                </div>
                <div class="gift-link-info-row">
                    <span>–°–æ–∑–¥–∞–Ω–∞:</span>
                    <span class="gift-link-info-value" id="viewGiftCreated">—Ç–æ–ª—å–∫–æ —á—Ç–æ</span>
                </div>
                <div class="gift-link-info-row">
                    <span>–ò—Å—Ç–µ–∫–∞–µ—Ç:</span>
                    <span class="gift-link-info-value" id="viewGiftExpires">—á–µ—Ä–µ–∑ 24 —á–∞—Å–∞</span>
                </div>
                
                <div id="viewGiftActivator" style="display: none;">
                    <div style="border-top: 1px solid var(--border); margin: 15px 0; padding-top: 15px;">
                        <div class="gift-link-info-row">
                            <span>–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª:</span>
                            <span class="gift-link-info-value" id="viewGiftActivatedBy">@username</span>
                        </div>
                        <div class="gift-link-info-row">
                            <span>–î–∞—Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:</span>
                            <span class="gift-link-info-value" id="viewGiftActivatedAt">—Ç–æ–ª—å–∫–æ —á—Ç–æ</span>
                        </div>
                    </div>
                </div>
                
                <div class="gift-link-code-box" id="viewGiftCode">/Gifts-Code/123qwerty...</div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="modal-btn primary" id="activateGiftBtn" onclick="activateGiftLink()" style="display: none;">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="modal-btn" onclick="copyGiftLink()" id="copyGiftBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –∑–≤–µ–∑–¥–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏ -->
    <div class="modal" id="starReactionModal">
        <div class="modal-content">
            <h2 class="modal-title">‚≠ê –ó–≤–µ–∑–¥–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è</h2>
            <p style="color: var(--text-gray); margin-bottom: 15px;">–ü–æ—Å—Ç–∞–≤—å—Ç–µ –∑–≤–µ–∑–¥—ã –Ω–∞ –ø–æ—Å—Ç (–¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –∫–∞–Ω–∞–ª–∞—Ö)</p>
            
            <div style="background: var(--bg-input); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: var(--text-gray);">–í–∞—à –±–∞–ª–∞–Ω—Å:</span>
                    <span style="color: var(--star); font-weight: 500;" id="starReactionBalance">0 ‚≠ê</span>
                </div>
            </div>

            <div class="star-reaction-input">
                <input type="number" id="starReactionAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥" min="1" max="1000" value="1">
                <span style="color: var(--star); font-size: 20px;">‚≠ê</span>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn star" onclick="sendStarReaction()">–ü–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è 2FA –ø—Ä–∏ –≤—Ö–æ–¥–µ -->
    <div class="modal" id="twofaModal">
        <div class="modal-content">
            <h2 class="modal-title">üîê –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</h2>
            <p style="color: var(--text-gray); margin-bottom: 15px;">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è</p>
            <input type="password" class="modal-input" placeholder="–ü–∞—Ä–æ–ª—å 2FA" id="twofaInput">
            <div id="twofaError" class="error-text"></div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn primary" onclick="verify2FA()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h2 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</h2>
            <input type="text" class="modal-input" placeholder="–ò–º—è *" id="settingsName">
            <input type="text" class="modal-input" placeholder="–§–∞–º–∏–ª–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" id="settingsLastName">
            <input type="text" class="modal-input" placeholder="–Æ–∑–µ—Ä–Ω–µ–π–º (—Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã)" id="settingsUsername" oninput="validateUsername(this)">
            <div id="settingsUsernameError" class="error-text"></div>
            <input type="text" class="modal-input" placeholder="–û —Å–µ–±–µ" id="settingsBio">
            
            <!-- Premium —Å—Ç–∞—Ç—É—Å -->
            <div style="margin: 15px 0; padding: 10px; background: var(--bg-input); border-radius: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: white;">üëë Premium —Å—Ç–∞—Ç—É—Å</span>
                    <span style="color: var(--premium); font-weight: 500;" id="premiumStatusDisplay">–ù–µ –∞–∫—Ç–∏–≤–µ–Ω</span>
                </div>
                <div style="color: var(--text-gray); font-size: 12px; margin-top: 5px;" id="premiumExpiryDisplay"></div>
            </div>
            
            <!-- Xost Bots –∫–Ω–æ–ø–∫–∞ -->
            <button class="info-xost-btn" onclick="toggleXostPanel()">
                ‚ö° Xost Bots
            </button>
            
            <!-- 2FA —Å–µ–∫—Ü–∏—è -->
            <div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span style="color: white;">üîê –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</span>
                    <label class="switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                        <input type="checkbox" id="twofaToggle" style="opacity: 0; width: 0; height: 0;" onchange="toggle2FA(this)">
                        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--bg-input); border-radius: 24px; transition: 0.3s;"></span>
                        <span style="position: absolute; content: ''; height: 20px; width: 20px; left: 2px; bottom: 2px; background-color: white; border-radius: 50%; transition: 0.3s;"></span>
                    </label>
                </div>
                <div id="twofaSetup" style="display: none;">
                    <input type="password" class="modal-input" placeholder="–ü–∞—Ä–æ–ª—å 2FA" id="twofaPassword">
                    <div style="color: var(--text-gray); font-size: 12px; margin-bottom: 10px;">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</div>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="modal-btn primary" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Xost Bots –ø–∞–Ω–µ–ª—å -->
    <div class="xost-panel" id="xostPanel">
        <div class="xost-header">
            <h3>‚ö° Xost Bots - –•–æ—Å—Ç–∏–Ω–≥ –±–æ—Ç–æ–≤</h3>
            <span class="xost-close" onclick="toggleXostPanel()">‚úï</span>
        </div>
        
        <div class="xost-balance" style="padding: 10px 15px; border-bottom: 1px solid var(--border);">
            <span>üí∞ –ë–∞–ª–∞–Ω—Å –∑–∞–ø—Ä–æ—Å–æ–≤:</span>
            <span id="xostRequestsBalance">0 / 100,000</span>
            <span class="xost-balance">üéÇ 0 —Ç–æ—Ä—Ç–æ–≤</span>
        </div>
        
        <div class="xost-tabs">
            <div class="xost-tab active" onclick="switchXostTab('bots')">–ú–æ–∏ –±–æ—Ç—ã</div>
            <div class="xost-tab" onclick="switchXostTab('create')">–°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞</div>
            <div class="xost-tab" onclick="switchXostTab('logs')">–õ–æ–≥–∏</div>
            <div class="xost-tab" onclick="switchXostTab('payment')">–û–ø–ª–∞—Ç–∞</div>
        </div>
        
        <div class="xost-content" id="xostContent">
            <!-- –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ -->
            <div id="xostBotsList" style="display: block;">
                <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
            
            <!-- –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ -->
            <div id="xostCreateBot" style="display: none;">
                <div class="xost-create-form">
                    <div class="xost-warning">
                        ‚ö†Ô∏è 100,000 –∑–∞–ø—Ä–æ—Å–æ–≤ = 1 üéÇ —Ç–æ—Ä—Ç. –ù–µ –æ–ø–ª–∞—Ç–∏—à—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Xost Bots –Ω–∞ –º–µ—Å—è—Ü.
                        –î–ª—è —Ç–µ—Å—Ç–∞ –ø–∏—à–∏ @Dyskrop
                    </div>
                    
                    <div class="xost-form-group">
                        <label class="xost-form-label">–¢–æ–∫–µ–Ω –±–æ—Ç–∞</label>
                        <input type="text" class="xost-form-input" id="xostBotToken" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞">
                    </div>
                    
                    <div class="xost-form-group">
                        <label class="xost-form-label">–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                        <select class="xost-form-select" id="xostBotLanguage">
                            <option value="python">Python</option>
                            <option value="javascript">JavaScript (Node.js)</option>
                            <option value="java">Java</option>
                            <option value="cpp">C++</option>
                            <option value="csharp">C#</option>
                            <option value="go">Go</option>
                            <option value="ruby">Ruby</option>
                            <option value="php">PHP</option>
                        </select>
                    </div>
                    
                    <div class="xost-form-group">
                        <label class="xost-form-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å –∫–æ–¥–æ–º</label>
                        <div class="xost-file-upload" onclick="document.getElementById('xostFileInput').click()">
                            üìÅ –ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª<br>
                            <span style="font-size: 11px;" id="xostFileName">–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</span>
                        </div>
                        <input type="file" id="xostFileInput" onchange="handleXostFileUpload(this)">
                    </div>
                    
                    <div class="xost-form-group">
                        <label class="xost-form-label">–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥</label>
                        <textarea class="xost-form-textarea" id="xostBotCode" placeholder='# –ü—Ä–∏–º–µ—Ä –¥–ª—è Python
TOK = "1234567890:ABCdef..."
# –≤–∞—à –∫–æ–¥ –±–æ—Ç–∞
print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω")'></textarea>
                    </div>
                    
                    <div class="xost-form-group">
                        <label class="xost-form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –±–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="text" class="xost-form-input" id="xostBotName" placeholder="–ú–æ–π —Å—É–ø–µ—Ä –±–æ—Ç">
                    </div>
                    
                    <button class="xost-create-btn" onclick="createXostBot()" id="xostCreateBtn">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ</button>
                </div>
            </div>
            
            <!-- –õ–æ–≥–∏ -->
            <div id="xostLogs" style="display: none;">
                <div class="xost-logs" id="xostLogsContent">
                    <div class="xost-log-line">
                        <span class="xost-log-time">[12:34:56]</span> –°–∏—Å—Ç–µ–º–∞: Xost Bots –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
                    </div>
                </div>
                <button class="xost-create-btn" style="margin-top: 10px;" onclick="clearXostLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
            </div>
            
            <!-- –û–ø–ª–∞—Ç–∞ -->
            <div id="xostPayment" style="display: none;">
                <div style="background: var(--bg-input); border-radius: 12px; padding: 20px;">
                    <h3 style="color: white; margin-bottom: 15px;">–¢–∞—Ä–∏—Ñ—ã Xost Bots</h3>
                    
                    <div style="background: var(--bg-dark); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: white;">100,000 –∑–∞–ø—Ä–æ—Å–æ–≤</span>
                            <span style="color: var(--star); font-weight: 500;">1 üéÇ —Ç–æ—Ä—Ç</span>
                        </div>
                        <div style="color: var(--text-gray); font-size: 12px;">
                            –°—Ä–æ–∫ –æ–ø–ª–∞—Ç—ã: 7 –¥–Ω–µ–π
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-dark); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: white;">–í–∞—à –±–∞–ª–∞–Ω—Å</span>
                            <span style="color: var(--star); font-weight: 500;" id="xostCakeBalance">0 üéÇ</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: white;">–ó–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ</span>
                            <span style="color: var(--text-gray);" id="xostRequestsUsed">0</span>
                        </div>
                    </div>
                    
                    <div class="xost-warning">
                        ‚ö†Ô∏è –ï—Å–ª–∏ –Ω–µ –æ–ø–ª–∞—Ç–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ - Xost Bots –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞ 1 –º–µ—Å—è—Ü.
                        –î–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä—Ç–æ–≤ –Ω–∞–ø–∏—à–∏—Ç–µ @Dyskrop
                    </div>
                    
                    <button class="xost-create-btn" style="margin-top: 15px;" onclick="contactDyskrop()">
                        üì® –ù–∞–ø–∏—Å–∞—Ç—å @Dyskrop –¥–ª—è –æ–ø–ª–∞—Ç—ã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ -->
    <div class="call-container" id="callContainer">
        <div class="call-header">
            <div>
                <div style="font-weight: 500; margin-bottom: 5px;" id="callUserName">–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞</div>
                <div class="call-info" id="callStatus">–ò–¥–µ—Ç –∑–≤–æ–Ω–æ–∫...</div>
            </div>
            <div style="font-size: 20px;" id="callDuration">00:00</div>
        </div>
        <div class="call-video" id="callVideo">
            <div class="remote-video" id="remoteVideo">
                <span style="font-size: 120px; opacity: 0.5;">üìπ</span>
            </div>
            <div class="local-video" id="localVideo">
                <span style="font-size: 50px;">üë§</span>
            </div>
        </div>
        <div class="call-controls">
            <div class="call-btn" onclick="toggleMic()" id="micBtn">üé§</div>
            <div class="call-btn" onclick="toggleVideo()" id="videoBtn">üìπ</div>
            <div class="call-btn end" onclick="endCall()">üìû</div>
        </div>
    </div>

    <!-- –°—Ç–∏–∫–µ—Ä –ø–∞–Ω–µ–ª—å -->
    <div class="sticker-panel" id="stickerPanel">
        <div class="sticker-header">
            <h3>–°—Ç–∏–∫–µ—Ä—ã</h3>
            <span style="color: var(--text-gray); cursor: pointer;" onclick="toggleStickers()">‚úï</span>
        </div>
        <div class="sticker-tabs">
            <div class="sticker-tab active" onclick="switchStickerTab('recent')">–ù–µ–¥–∞–≤–Ω–∏–µ</div>
            <div class="sticker-tab" onclick="switchStickerTab('animals')">–ñ–∏–≤–æ—Ç–Ω—ã–µ</div>
            <div class="sticker-tab" onclick="switchStickerTab('faces')">–°–º–∞–π–ª—ã</div>
        </div>
        <div class="sticker-grid" id="stickerGrid">
            <div class="sticker-item" onclick="sendSticker('üòä')">üòä</div>
            <div class="sticker-item" onclick="sendSticker('üòÇ')">üòÇ</div>
            <div class="sticker-item" onclick="sendSticker('ü•≤')">ü•≤</div>
            <div class="sticker-item" onclick="sendSticker('üòé')">üòé</div>
            <div class="sticker-item" onclick="sendSticker('üò≠')">üò≠</div>
            <div class="sticker-item" onclick="sendSticker('üò°')">üò°</div>
            <div class="sticker-item" onclick="sendSticker('üëç')">üëç</div>
            <div class="sticker-item" onclick="sendSticker('‚ù§Ô∏è')">‚ù§Ô∏è</div>
            <div class="sticker-item" onclick="sendSticker('üî•')">üî•</div>
            <div class="sticker-item" onclick="sendSticker('üëÄ')">üëÄ</div>
            <div class="sticker-item" onclick="sendSticker('üê∂')">üê∂</div>
            <div class="sticker-item" onclick="sendSticker('üê±')">üê±</div>
            <div class="sticker-item" onclick="sendSticker('üêº')">üêº</div>
            <div class="sticker-item" onclick="sendSticker('ü¶ä')">ü¶ä</div>
            <div class="sticker-item" onclick="sendSticker('üê∏')">üê∏</div>
            <div class="sticker-item" onclick="sendSticker('üê®')">üê®</div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∑–≤–µ–∑–¥ -->
    <div class="stars-panel" id="starsPanel">
        <div class="stars-header">
            <h3>‚≠ê –ó–≤–µ–∑–¥—ã</h3>
            <div class="stars-balance-large" id="starsBalanceDisplay">0 ‚≠ê</div>
        </div>
        <div style="padding: 10px 15px; color: var(--text-gray); font-size: 13px; border-bottom: 1px solid var(--border);">
            –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
        </div>
        <div class="stars-grid" id="starsGrid">
            <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –ø–æ–¥–∞—Ä–∫–æ–≤ -->
    <div class="gifts-panel" id="giftsPanel">
        <div class="gifts-header">
            <h3>üéÅ –ü–æ–¥–∞—Ä–∫–∏</h3>
            <div class="gifts-balance" id="giftsBalanceDisplay">–ë–∞–ª–∞–Ω—Å: 0 ‚≠ê</div>
        </div>
        <div class="gifts-grid" id="giftsGrid">
            <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å Gift —Å—Å—ã–ª–æ–∫ -->
    <div class="gift-links-panel" id="giftLinksPanel">
        <div class="gift-links-header">
            <h3>üéÅ Gift —Å—Å—ã–ª–∫–∏</h3>
            <span style="color: var(--text-gray); cursor: pointer;" onclick="toggleGiftLinksPanel()">‚úï</span>
        </div>
        <div class="gift-links-list" id="giftLinksList">
            <!-- –°–ø–∏—Å–æ–∫ gift —Å—Å—ã–ª–æ–∫ -->
        </div>
        <button class="create-gift-link-btn" onclick="openCreateGiftLinkModal()" id="createGiftLinkBtn">‚ú® –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É (100,000 ‚≠ê)</button>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –±–æ—Ç–æ–≤ -->
    <div class="bots-panel" id="botsPanel">
        <div class="bots-header">
            <h3>–ú–æ–∏ –±–æ—Ç—ã</h3>
            <span style="color: var(--text-gray); cursor: pointer;" onclick="toggleBotsPanel()">‚úï</span>
        </div>
        <div class="bots-list" id="botsList">
            <!-- –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
        <div style="padding: 15px; border-top: 1px solid var(--border);">
            <button class="modal-btn bot" onclick="openBotFather()" style="width: 100%;">ü§ñ BotFather</button>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è —Ñ–∞–π–ª–æ–≤ -->
    <input type="file" id="fileInput" onchange="sendFile(this)">
    <input type="file" id="xostFileInput" onchange="handleXostFileUpload(this)" style="display: none;">

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="blaxgram-app">
        <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div class="auth-container" id="authScreen">
            <div class="auth-card" id="phoneScreen">
                <div class="auth-logo">‚úàÔ∏è</div>
                <h1 class="auth-title">BlaxGram</h1>
                <div class="auth-subtitle">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
                <input type="text" class="auth-input" placeholder="+7 999 123-45-67" id="phoneInput" value="+7 999 123-45-67">
                <button class="auth-btn" onclick="sendCode()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                <div class="auth-link">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <span>–í–æ–π—Ç–∏</span></div>
            </div>

            <div class="auth-card" id="codeScreen" style="display: none;">
                <div class="auth-logo">üîê</div>
                <h1 class="auth-title">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥</h1>
                <div class="auth-subtitle">–û—Ç–ø—Ä–∞–≤–∏–ª–∏ –Ω–∞ +7 999 123-45-67</div>
                <div class="code-inputs">
                    <div class="code-digit" id="code1">1</div>
                    <div class="code-digit" id="code2">2</div>
                    <div class="code-digit" id="code3">3</div>
                    <div class="code-digit" id="code4">4</div>
                    <div class="code-digit" id="code5">5</div>
                </div>
                <button class="auth-btn" onclick="verifyCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <div class="auth-link">–ù–µ –ø—Ä–∏—à–µ–ª –∫–æ–¥? <span>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—â–µ</span></div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
        <div class="main-interface" id="mainInterface">
            <!-- –õ–µ–≤—ã–π —Å–∞–π–¥–±–∞—Ä -->
            <div class="sidebar">
                <div class="sidebar-icon active" onclick="switchTab('chats')">üí¨</div>
                <div class="sidebar-icon" onclick="switchTab('contacts')">üë•</div>
                <div class="sidebar-icon" onclick="switchTab('calls')">üìû</div>
                <div class="sidebar-icon" onclick="switchTab('saved')">üîñ</div>
                <div style="flex: 1"></div>
                <div class="sidebar-icon" onclick="openCreateModal()">‚ûï</div>
                <div class="sidebar-icon" onclick="toggleStarsPanel()">‚≠ê</div>
                <div class="sidebar-icon" onclick="toggleGiftLinksPanel()">üéÅ</div>
                <div class="sidebar-icon" onclick="toggleBotsPanel()" style="color: var(--bot);">ü§ñ</div>
                <div class="avatar-small" onclick="openSettings()" id="headerAvatar">
                    –ú
                    <span class="premium-badge-small" id="headerPremiumBadge" style="display: none;">üëë</span>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
            <div class="chats-panel">
                <div class="chats-header">
                    <h2>BlaxGram</h2>
                    <input type="text" class="chats-search" placeholder="–ü–æ–∏—Å–∫..." id="searchInput" oninput="filterChats()">
                </div>
                <div class="chats-tabs">
                    <div class="tab active" onclick="filterChats('all')">–í—Å–µ</div>
                    <div class="tab" onclick="filterChats('private')">–õ–∏—á–Ω—ã–µ</div>
                    <div class="tab" onclick="filterChats('channel')">–ö–∞–Ω–∞–ª—ã</div>
                    <div class="tab" onclick="filterChats('group')">–ì—Ä—É–ø–ø—ã</div>
                    <div class="tab" onclick="filterChats('bot')">–ë–æ—Ç—ã</div>
                </div>
                <div class="chats-list" id="chatsList"></div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
            <div class="main-chat" id="mainChat">
                <div class="chat-header" id="chatHeader">
                    <div class="header-avatar" id="currentChatAvatar">üë§</div>
                    <div class="header-info">
                        <div class="header-name">
                            <span id="currentChatName">Telegram Bot</span>
                            <span class="verified" id="verifiedBadge" style="display: none;">‚úì</span>
                            <span class="premium-icon" id="premiumBadge" style="display: none;">üëë</span>
                        </div>
                        <div class="header-status" id="currentChatStatus">–±–æ—Ç</div>
                    </div>
                    <div class="header-actions">
                        <span onclick="openInfo()">üîç</span>
                        <span onclick="startCall('audio')">üìû</span>
                        <span onclick="startCall('video')">üìπ</span>
                        <span>‚ãÆ</span>
                    </div>
                </div>

                <div class="messages-area" id="messagesArea"></div>

                <!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ–º) -->
                <div id="replyContainer" style="display: none; padding: 10px 20px; background: var(--bg-sidebar); border-top: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 10px; color: var(--text-gray);">
                        <span>‚Ü©Ô∏è –û—Ç–≤–µ—Ç –Ω–∞:</span>
                        <span style="flex: 1; background: var(--bg-input); padding: 8px 12px; border-radius: 12px; font-size: 13px;" id="replyText">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
                        <span style="cursor: pointer; color: var(--error);" onclick="cancelReply()">‚úï</span>
                    </div>
                </div>

                <div class="input-area" id="inputArea">
                    <div class="attach-btn" onclick="openFileDialog()">üìé</div>
                    <div class="sticker-btn" onclick="toggleStickers()">üòä</div>
                    <div class="gift-btn" onclick="toggleGiftsPanel()">üéÅ</div>
                    <div class="gift-link-btn" onclick="toggleGiftLinksPanel()">üîó</div>
                    <div class="bot-btn" onclick="openBotFather()">ü§ñ</div>
                    <div class="star-balance" onclick="toggleStarsPanel()" id="headerStarBalance">0 ‚≠ê</div>
                    <input type="text" class="message-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." id="messageInput" onkeydown="handleKeyPress(event)">
                    <div class="send-btn" onclick="sendMessage()">‚û§</div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å (–∏–Ω—Ñ–æ) -->
            <div class="info-panel" id="infoPanel" style="display: none;">
                <div class="info-header">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <span class="close-info" onclick="closeInfo()">‚úï</span>
                </div>
                
                <div id="infoContent">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è -->
                </div>
                
                <button class="info-xost-btn" onclick="toggleXostPanel()">
                    ‚ö° Xost Bots - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== –î–ê–ù–ù–´–ï ==========
        let isAuthenticated = false;
        let currentUser = null;
        
        // –ë–∞–∑–∞ —é–∑–µ—Ä–Ω–µ–π–º–æ–≤ (–æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
        let takenUsernames = ['@blaxgram', '@bot', '@anna_s', '@ivan_p', '@blaxgram_chat', '@botfather'];
        
        // –ë–∞–∑–∞ —á–∞—Ç–æ–≤ (–æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
        let chats = [];
        
        // –ú–æ–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–∞—Ç—ã (–≤ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å)
        let myCreatedChats = [];

        // –ë–∞–∑–∞ –±–æ—Ç–æ–≤
        let bots = [];
        
        // –ë–∞–∑–∞ Gift —Å—Å—ã–ª–æ–∫
        let giftLinks = [];
        
        // Xost Bots –¥–∞–Ω–Ω—ã–µ
        let xostBots = [];
        let xostLogs = [];
        let xostRequests = {
            used: 0,
            limit: 100000,
            cakes: 0,
            paymentDeadline: null,
            blocked: false
        };
        
        // BotFather –¥–∞–Ω–Ω—ã–µ
        let botFatherState = {
            step: null,
            tempBot: null,
            tempToken: null
        };

        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —á–∞—Ç—ã
        const defaultChats = [
            {
                id: 1,
                type: 'private',
                name: '–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞',
                username: '@anna_s',
                avatar: 'üë©',
                lastMessage: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
                time: '12:45',
                unread: 0,
                online: true,
                verified: false,
                createdBy: null,
                messages: [
                    { id: 1, text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?', sender: 'them', time: '12:45', date: '–°–µ–≥–æ–¥–Ω—è', reactions: {}, starReactions: 0, edited: false }
                ]
            },
            {
                id: 2,
                type: 'private',
                name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
                username: '@ivan_p',
                avatar: 'üë®',
                lastMessage: '–°–∫–∏–Ω—å –∫–æ–Ω—Ç–∞–∫—Ç—ã',
                time: '11:20',
                unread: 2,
                online: false,
                verified: false,
                createdBy: null,
                messages: [
                    { id: 1, text: '–°–∫–∏–Ω—å –∫–æ–Ω—Ç–∞–∫—Ç—ã', sender: 'them', time: '11:20', date: '–°–µ–≥–æ–¥–Ω—è', reactions: {}, starReactions: 0, edited: false }
                ]
            },
            {
                id: 3,
                type: 'bot',
                name: 'Telegram Bot',
                username: '@bot',
                avatar: 'ü§ñ',
                lastMessage: '–Ø –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫',
                time: '10:30',
                unread: 3,
                online: true,
                verified: true,
                createdBy: null,
                messages: [
                    { id: 1, text: '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç-–∞–≤—Ç–æ–æ—Ç–≤–µ—Ç—á–∏–∫', sender: 'them', time: '10:30', date: '–°–µ–≥–æ–¥–Ω—è', reactions: {}, starReactions: 0, edited: false },
                    { id: 2, text: '–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å', sender: 'them', time: '10:31', date: '–°–µ–≥–æ–¥–Ω—è', reactions: {}, starReactions: 0, edited: false }
                ]
            },
            {
                id: -1001,
                type: 'channel',
                name: 'BlaxGram News',
                username: '@blaxgram',
                avatar: 'üì¢',
                lastMessage: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è',
                time: '09:15',
                unread: 5,
                online: false,
                verified: true,
                createdBy: null,
                messages: [
                    { id: 1, text: '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è BlaxGram 2.0 —Å Xost Bots!', sender: 'channel', time: '09:15', date: '–°–µ–≥–æ–¥–Ω—è', reactions: {}, starReactions: 1250, edited: false }
                ]
            },
            {
                id: -47521,
                type: 'group',
                name: 'BlaxGram Community',
                username: '@blaxgram_chat',
                avatar: 'üë•',
                lastMessage: '–ê–Ω–Ω–∞: –≤—Å–µ–º –ø—Ä–∏–≤–µ—Ç!',
                time: '08:50',
                unread: 12,
                online: false,
                verified: false,
                createdBy: null,
                messages: [
                    { id: 1, text: '–í—Å–µ–º –ø—Ä–∏–≤–µ—Ç!', sender: 'them', name: '–ê–Ω–Ω–∞', time: '08:50', date: '–°–µ–≥–æ–¥–Ω—è', reactions: {}, starReactions: 0, edited: false }
                ]
            },
            {
                id: 6,
                type: 'bot',
                name: 'BotFather',
                username: '@botfather',
                avatar: 'üë®‚Äçüîß',
                lastMessage: '–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞',
                time: '00:00',
                unread: 0,
                online: true,
                verified: true,
                createdBy: null,
                messages: [
                    { id: 1, text: '–ü—Ä–∏–≤–µ—Ç! –Ø BotFather. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º.', sender: 'them', time: '00:00', date: '–°–µ–≥–æ–¥–Ω—è', reactions: {}, starReactions: 0, edited: false },
                    { id: 2, text: '–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã:\n/newbot - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞\n/mybots - –º–æ–∏ –±–æ—Ç—ã\n/setname - –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è\n/setdescription - –∏–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ\n/token - –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω', sender: 'them', time: '00:01', date: '–°–µ–≥–æ–¥–Ω—è', reactions: {}, starReactions: 0, edited: false }
                ]
            }
        ];

        // –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤
        const availableGifts = [
            { id: 1, name: '–°–µ—Ä–¥—Ü–µ', icon: '‚ù§Ô∏è', price: 25 },
            { id: 2, name: '–•–ª–æ–ø—É—à–∫–∞', icon: 'üéâ', price: 25 },
            { id: 3, name: '–ö–ª–æ—É–Ω', icon: 'ü§°', price: 25 },
            { id: 4, name: '–¢–æ—Ä—Ç', icon: 'üéÇ', price: 100000 }, // –¢–æ—Ä—Ç –¥–ª—è Xost Bots
            { id: 5, name: '–ö–µ–Ω–¥–∏', icon: 'üç¨', price: 250 },
            { id: 6, name: '–®–∞—Ä–¥', icon: 'üíé', price: 500 }
        ];

        // –ù–æ–º–∏–Ω–∞–ª—ã –∑–≤–µ–∑–¥ –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
        const starNominals = [15, 30, 50, 100, 250, 500, 750, 1000, 2500, 5000, 7500, 10000];

        let currentChatId = 3;
        let botResponses = [
            '–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?',
            '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ...',
            '–Ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫',
            '–°–µ–π—á–∞—Å –ø–æ—Å–º–æ—Ç—Ä—é',
            '–•–æ—Ä–æ—à–æ, –ø–æ–Ω—è–ª',
            '–ú–æ–∂–µ—à—å –ø–æ–≤—Ç–æ—Ä–∏—Ç—å?',
            '–î–∞, –∫–æ–Ω–µ—á–Ω–æ',
            '–ù–µ –ø–æ–Ω—è–ª –≤–æ–ø—Ä–æ—Å'
        ];

        // ========== –ù–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        let replyingToMessage = null; // –î–ª—è —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        let editingMessage = null; // –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        let twoFAEnabled = false; // –°—Ç–∞—Ç—É—Å 2FA
        let twoFAPassword = ''; // –ü–∞—Ä–æ–ª—å 2FA (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ —Ö–µ—à–µ)
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
        let currentCall = null;
        let callTimer = null;
        let callSeconds = 0;
        let micEnabled = true;
        let videoEnabled = true;
        
        // –¢–µ–∫—É—â–∞—è –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–∞—è gift —Å—Å—ã–ª–∫–∞
        let currentViewingGiftLink = null;
        
        // –¢–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∑–≤–µ–∑–¥–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏
        let currentStarReactionMessage = null;
        
        // Xost Bots
        let currentXostFile = null;

        // ========== –í–ê–õ–ò–î–ê–¶–ò–Ø –Æ–ó–ï–†–ù–ï–ô–ú–û–í ==========
        function validateUsername(input) {
            let value = input.value;
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –Ω–∏–∂–Ω–µ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ
            const regex = /^@[a-zA-Z0-9_]*$/;
            if (value && !regex.test(value)) {
                // –£–¥–∞–ª—è–µ–º –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã
                value = '@' + value.substring(1).replace(/[^a-zA-Z0-9_]/g, '');
                input.value = value;
                input.style.borderColor = 'var(--error)';
            } else {
                input.style.borderColor = '';
            }
        }

        function validateBotUsername(input) {
            let value = input.value;
            // –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ 'bot' –∏–ª–∏ 'Bot'
            const regex = /^@[a-zA-Z0-9_]*$/;
            if (value && !regex.test(value)) {
                value = '@' + value.substring(1).replace(/[^a-zA-Z0-9_]/g, '');
                input.value = value;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏–µ
            if (value && value.length > 1) {
                const withoutAt = value.substring(1);
                if (!withoutAt.toLowerCase().endsWith('bot')) {
                    document.getElementById('botSettingsError').innerText = '–Æ–∑–µ—Ä–Ω–µ–π–º –±–æ—Ç–∞ –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ "bot"';
                } else {
                    document.getElementById('botSettingsError').innerText = '';
                }
            }
        }

        function isUsernameValid(username) {
            if (!username || username.length < 2) return false;
            if (!username.startsWith('@')) return false;
            // –¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –Ω–∏–∂–Ω–µ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ
            const regex = /^@[a-zA-Z0-9_]+$/;
            return regex.test(username);
        }

        function isBotUsernameValid(username) {
            if (!isUsernameValid(username)) return false;
            const withoutAt = username.substring(1);
            return withoutAt.toLowerCase().endsWith('bot');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –∫–∞–Ω–∞–ª–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å _vf –≤ –∫–æ–Ω—Ü–µ)
        function isChannelVerified(username) {
            if (!username) return false;
            return username.toLowerCase().endsWith('_vf');
        }

        // ========== –û–ë–õ–ê–ß–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï (localStorage) ==========
        function loadFromCloud() {
            const saved = localStorage.getItem('blaxgram_data_v3');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    chats = data.chats || defaultChats;
                    takenUsernames = data.takenUsernames || ['@blaxgram', '@bot', '@anna_s', '@ivan_p', '@blaxgram_chat', '@botfather'];
                    myCreatedChats = data.myCreatedChats || [];
                    twoFAEnabled = data.twoFAEnabled || false;
                    twoFAPassword = data.twoFAPassword || '';
                    bots = data.bots || [];
                    giftLinks = data.giftLinks || [];
                    xostBots = data.xostBots || [];
                    xostRequests = data.xostRequests || { used: 0, limit: 100000, cakes: 0, paymentDeadline: null, blocked: false };
                    if (data.currentUser) {
                        currentUser = data.currentUser;
                        document.getElementById('headerAvatar').innerText = currentUser.name.charAt(0);
                        if (!currentUser.stars) currentUser.stars = 0;
                        if (!currentUser.gifts) currentUser.gifts = [];
                        if (!currentUser.premium) currentUser.premium = null;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º premium –±–µ–π–¥–∂
                        updatePremiumBadge();
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', e);
                    chats = defaultChats;
                }
            } else {
                chats = defaultChats;
            }
        }

        function saveToCloud() {
            const data = {
                chats: chats,
                takenUsernames: takenUsernames,
                myCreatedChats: myCreatedChats,
                currentUser: currentUser,
                twoFAEnabled: twoFAEnabled,
                twoFAPassword: twoFAPassword,
                bots: bots,
                giftLinks: giftLinks,
                xostBots: xostBots,
                xostRequests: xostRequests
            };
            localStorage.setItem('blaxgram_data_v3', JSON.stringify(data));
        }

        // ========== –ü–†–û–í–ï–†–ö–ê –Æ–ó–ï–†–ù–ï–ô–ú–ê ==========
        function isUsernameTaken(username) {
            return takenUsernames.includes(username);
        }

        // ========== XOST BOTS ==========
        function toggleXostPanel() {
            const panel = document.getElementById('xostPanel');
            panel.classList.toggle('active');
            closeModal();
            
            if (panel.classList.contains('active')) {
                renderXostBots();
                updateXostUI();
                addXostLog('–°–∏—Å—Ç–µ–º–∞', 'Xost Bots –ø–∞–Ω–µ–ª—å –æ—Ç–∫—Ä—ã—Ç–∞');
            }
        }

        function switchXostTab(tab) {
            document.querySelectorAll('.xost-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('xostBotsList').style.display = tab === 'bots' ? 'block' : 'none';
            document.getElementById('xostCreateBot').style.display = tab === 'create' ? 'block' : 'none';
            document.getElementById('xostLogs').style.display = tab === 'logs' ? 'block' : 'none';
            document.getElementById('xostPayment').style.display = tab === 'payment' ? 'block' : 'none';
            
            if (tab === 'logs') {
                renderXostLogs();
            } else if (tab === 'payment') {
                updatePaymentUI();
            }
        }

        function renderXostBots() {
            const container = document.getElementById('xostBotsList');
            if (!container) return;
            
            if (xostRequests.blocked) {
                container.innerHTML = `
                    <div class="xost-warning" style="margin-bottom: 15px;">
                        ‚ö†Ô∏è Xost Bots –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ ${new Date(xostRequests.blocked).toLocaleDateString()}<br>
                        –ü—Ä–∏—á–∏–Ω–∞: –ø—Ä–æ—Å—Ä–æ—á–∫–∞ –æ–ø–ª–∞—Ç—ã
                    </div>
                `;
            }
            
            if (xostBots.length === 0) {
                container.innerHTML += '<div style="color: var(--text-gray); text-align: center; padding: 20px;">–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤</div>';
                return;
            }
            
            xostBots.forEach(bot => {
                const botEl = document.createElement('div');
                botEl.className = `xost-bot-item ${bot.status}`;
                
                const statusClass = bot.status === 'running' ? 'status-running' : bot.status === 'stopped' ? 'status-stopped' : 'status-error';
                const statusText = bot.status === 'running' ? '–ó–∞–ø—É—â–µ–Ω' : bot.status === 'stopped' ? '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' : '–û—à–∏–±–∫–∞';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã
                const paymentWarning = bot.paymentDeadline && new Date(bot.paymentDeadline) < new Date() ? 
                    '<div class="xost-bot-warning">‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–∫–∞ –æ–ø–ª–∞—Ç—ã! –ë–æ—Ç –±—É–¥–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>' : '';
                
                botEl.innerHTML = `
                    <div class="xost-bot-header">
                        <div class="xost-bot-name">
                            ${bot.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}
                            <span class="xost-bot-status ${statusClass}">${statusText}</span>
                        </div>
                        <div>${bot.language}</div>
                    </div>
                    <div class="xost-bot-stats">
                        <span class="xost-bot-stat">üìä –ó–∞–ø—Ä–æ—Å—ã: ${bot.requests || 0}/${xostRequests.limit}</span>
                        <span class="xost-bot-stat">‚è±Ô∏è Uptime: ${bot.uptime || '0—á'}</span>
                        <span class="xost-bot-stat">üíæ RAM: ${bot.ram || '32MB'}</span>
                    </div>
                    ${paymentWarning}
                    <div class="xost-bot-actions">
                        ${bot.status !== 'running' ? 
                            `<button class="xost-btn start" onclick="startXostBot('${bot.id}')">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>` : 
                            `<button class="xost-btn stop" onclick="stopXostBot('${bot.id}')">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>`}
                        <button class="xost-btn restart" onclick="restartXostBot('${bot.id}')">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
                        <button class="xost-btn logs" onclick="viewXostBotLogs('${bot.id}')">üìã –õ–æ–≥–∏</button>
                        <button class="xost-btn" style="background: var(--error);" onclick="deleteXostBot('${bot.id}')">üóëÔ∏è</button>
                    </div>
                `;
                
                container.appendChild(botEl);
            });
        }

        function handleXostFileUpload(input) {
            if (!input.files || !input.files[0]) return;
            
            currentXostFile = input.files[0];
            document.getElementById('xostFileName').innerHTML = `üìÅ ${currentXostFile.name}`;
            
            // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('xostBotCode').value = e.target.result;
            };
            reader.readAsText(currentXostFile);
        }

        function createXostBot() {
            if (xostRequests.blocked) {
                alert('Xost Bots –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É –æ–ø–ª–∞—Ç—ã');
                return;
            }
            
            const token = document.getElementById('xostBotToken').value.trim();
            const language = document.getElementById('xostBotLanguage').value;
            const code = document.getElementById('xostBotCode').value.trim();
            const name = document.getElementById('xostBotName').value.trim() || '–ë–æ—Ç –Ω–∞ ' + language;
            
            if (!token) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞');
                return;
            }
            
            if (!code) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –±–æ—Ç–∞');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ TOK = {token} –≤ –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö
            const firstLines = code.split('\n').slice(0, 5).join('\n');
            if (!firstLines.includes('TOK =') && !firstLines.includes('TOK=')) {
                alert('–û—à–∏–±–∫–∞: –í –ø–µ—Ä–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö –∫–æ–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å TOK = {—Ç–æ–∫–µ–Ω –±–æ—Ç–∞}');
                return;
            }
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –∫–æ–¥–∞
            const tokenMatch = code.match(/TOK\s*=\s*["']([^"']+)["']/);
            if (!tokenMatch || tokenMatch[1] !== token) {
                alert('–¢–æ–∫–µ–Ω –≤ –ø–æ–ª–µ –∏ –≤ –∫–æ–¥–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
            const botId = 'xost_' + Date.now();
            const deadline = new Date();
            deadline.setDate(deadline.getDate() + 7); // +7 –¥–Ω–µ–π
            
            const newBot = {
                id: botId,
                token: token,
                language: language,
                code: code,
                name: name,
                status: 'running',
                createdAt: new Date().toISOString(),
                requests: 0,
                uptime: '0—á',
                ram: '32MB',
                paymentDeadline: deadline.toISOString(),
                logs: []
            };
            
            xostBots.push(newBot);
            addXostLog('–ë–æ—Ç', `–ë–æ—Ç "${name}" –∑–∞–ø—É—â–µ–Ω –Ω–∞ ${language}`);
            
            saveToCloud();
            renderXostBots();
            switchXostTab('bots');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('xostBotToken').value = '';
            document.getElementById('xostBotCode').value = '';
            document.getElementById('xostBotName').value = '';
            document.getElementById('xostFileName').innerHTML = '–§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω';
            currentXostFile = null;
        }

        function startXostBot(botId) {
            const bot = xostBots.find(b => b.id === botId);
            if (!bot) return;
            
            bot.status = 'running';
            addXostLog('–ë–æ—Ç', `–ë–æ—Ç "${bot.name}" –∑–∞–ø—É—â–µ–Ω`);
            saveToCloud();
            renderXostBots();
        }

        function stopXostBot(botId) {
            const bot = xostBots.find(b => b.id === botId);
            if (!bot) return;
            
            bot.status = 'stopped';
            addXostLog('–ë–æ—Ç', `–ë–æ—Ç "${bot.name}" –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`);
            saveToCloud();
            renderXostBots();
        }

        function restartXostBot(botId) {
            const bot = xostBots.find(b => b.id === botId);
            if (!bot) return;
            
            bot.status = 'running';
            addXostLog('–ë–æ—Ç', `–ë–æ—Ç "${bot.name}" –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω`);
            saveToCloud();
            renderXostBots();
        }

        function deleteXostBot(botId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –±–æ—Ç–∞ —Å —Ö–æ—Å—Ç–∏–Ω–≥–∞?')) return;
            
            const index = xostBots.findIndex(b => b.id === botId);
            if (index !== -1) {
                const bot = xostBots[index];
                xostBots.splice(index, 1);
                addXostLog('–°–∏—Å—Ç–µ–º–∞', `–ë–æ—Ç "${bot.name}" —É–¥–∞–ª–µ–Ω`);
                saveToCloud();
                renderXostBots();
            }
        }

        function viewXostBotLogs(botId) {
            const bot = xostBots.find(b => b.id === botId);
            if (!bot) return;
            
            switchXostTab('logs');
            let logsHtml = '';
            
            if (bot.logs && bot.logs.length > 0) {
                bot.logs.forEach(log => {
                    logsHtml += `<div class="xost-log-line"><span class="xost-log-time">[${log.time}]</span> ${log.message}</div>`;
                });
            } else {
                logsHtml = '<div class="xost-log-line">–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
            }
            
            document.getElementById('xostLogsContent').innerHTML = logsHtml;
        }

        function addXostLog(type, message) {
            const time = new Date().toLocaleTimeString();
            const log = { time, type, message };
            
            xostLogs.push(log);
            if (xostLogs.length > 100) xostLogs.shift();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–æ—Ç–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            // TODO
        }

        function renderXostLogs() {
            let logsHtml = '';
            xostLogs.forEach(log => {
                logsHtml += `<div class="xost-log-line"><span class="xost-log-time">[${log.time}]</span> ${log.type}: ${log.message}</div>`;
            });
            
            if (logsHtml === '') {
                logsHtml = '<div class="xost-log-line">–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>';
            }
            
            document.getElementById('xostLogsContent').innerHTML = logsHtml;
        }

        function clearXostLogs() {
            xostLogs = [];
            renderXostLogs();
        }

        function updateXostUI() {
            const used = xostRequests.used || 0;
            const limit = xostRequests.limit || 100000;
            const cakes = xostRequests.cakes || 0;
            
            document.getElementById('xostRequestsBalance').innerHTML = `${used} / ${limit}`;
            document.getElementById('xostCakeBalance').innerHTML = `${cakes} üéÇ`;
            document.getElementById('xostRequestsUsed').innerHTML = used;
        }

        function updatePaymentUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –æ–ø–ª–∞—Ç—ã
        }

        function contactDyskrop() {
            alert('–ù–∞–ø–∏—à–∏—Ç–µ @Dyskrop –≤ Telegram –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ—Ä—Ç–æ–≤');
        }

        function checkXostPayments() {
            const now = new Date();
            xostBots.forEach(bot => {
                if (bot.paymentDeadline && new Date(bot.paymentDeadline) < now) {
                    bot.status = 'stopped';
                    
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º Xost Bots –Ω–∞ –º–µ—Å—è—Ü
                    const blockUntil = new Date();
                    blockUntil.setMonth(blockUntil.getMonth() + 1);
                    xostRequests.blocked = blockUntil.toISOString();
                    
                    addXostLog('–°–∏—Å—Ç–µ–º–∞', `‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–∫–∞ –æ–ø–ª–∞—Ç—ã! Xost Bots –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –¥–æ ${blockUntil.toLocaleDateString()}`);
                }
            });
            saveToCloud();
        }

        // ========== PREMIUM ==========
        function updatePremiumBadge() {
            const isPremium = currentUser?.premium && new Date(currentUser.premium) > new Date();
            
            const headerBadge = document.getElementById('headerPremiumBadge');
            if (headerBadge) {
                headerBadge.style.display = isPremium ? 'flex' : 'none';
            }
            
            const premiumBadge = document.getElementById('premiumBadge');
            if (premiumBadge) {
                premiumBadge.style.display = isPremium ? 'inline' : 'none';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
            const premiumStatus = document.getElementById('premiumStatusDisplay');
            const premiumExpiry = document.getElementById('premiumExpiryDisplay');
            
            if (premiumStatus) {
                if (isPremium) {
                    premiumStatus.innerHTML = 'üëë –ê–∫—Ç–∏–≤–µ–Ω';
                    premiumStatus.style.color = 'var(--premium)';
                    
                    const expiryDate = new Date(currentUser.premium);
                    premiumExpiry.innerHTML = `–ò—Å—Ç–µ–∫–∞–µ—Ç: ${expiryDate.toLocaleDateString()}`;
                } else {
                    premiumStatus.innerHTML = '–ù–µ –∞–∫—Ç–∏–≤–µ–Ω';
                    premiumStatus.style.color = 'var(--text-gray)';
                    premiumExpiry.innerHTML = '';
                }
            }
        }

        function activatePremium(days = 30) {
            if (!currentUser) return;
            
            const now = new Date();
            if (currentUser.premium && new Date(currentUser.premium) > now) {
                // –ü—Ä–æ–¥–ª–µ–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
                const currentExpiry = new Date(currentUser.premium);
                currentExpiry.setDate(currentExpiry.getDate() + days);
                currentUser.premium = currentExpiry.toISOString();
            } else {
                // –ù–æ–≤—ã–π premium
                const expiry = new Date();
                expiry.setDate(expiry.getDate() + days);
                currentUser.premium = expiry.toISOString();
            }
            
            saveToCloud();
            updatePremiumBadge();
        }

        // ========== GIFT –°–°–´–õ–ö–ò ==========
        function generateGiftCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '/Gifts-Code/';
            for (let i = 0; i < 48; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        function toggleGiftLinksPanel() {
            const panel = document.getElementById('giftLinksPanel');
            const starsPanel = document.getElementById('starsPanel');
            const giftsPanel = document.getElementById('giftsPanel');
            const stickerPanel = document.getElementById('stickerPanel');
            const botsPanel = document.getElementById('botsPanel');
            const xostPanel = document.getElementById('xostPanel');
            
            starsPanel.classList.remove('active');
            giftsPanel.classList.remove('active');
            stickerPanel.classList.remove('active');
            botsPanel.classList.remove('active');
            xostPanel.classList.remove('active');
            panel.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                renderGiftLinksList();
            }
        }

        function renderGiftLinksList() {
            const list = document.getElementById('giftLinksList');
            if (!list) return;
            
            list.innerHTML = '';
            
            if (!giftLinks || giftLinks.length === 0) {
                list.innerHTML = '<div style="color: var(--text-gray); text-align: center; padding: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç gift —Å—Å—ã–ª–æ–∫</div>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            const sortedLinks = [...giftLinks].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            sortedLinks.forEach(link => {
                const now = new Date();
                const expiresAt = new Date(link.expiresAt);
                const isExpired = expiresAt < now;
                const isActive = !link.activatedBy && !isExpired;
                
                const linkItem = document.createElement('div');
                linkItem.className = `gift-link-item ${isActive ? 'active' : ''}`;
                linkItem.onclick = () => viewGiftLink(link.code);
                
                const createdDate = new Date(link.createdAt).toLocaleString();
                const expiresDate = new Date(link.expiresAt).toLocaleString();
                
                let statusHtml = '';
                if (link.activatedBy) {
                    statusHtml = `<span class="gift-link-status status-used">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞</span>`;
                } else if (isExpired) {
                    statusHtml = `<span class="gift-link-status status-used">–ò—Å—Ç–µ–∫–ª–∞</span>`;
                } else {
                    statusHtml = `<span class="gift-link-status status-active">–ê–∫—Ç–∏–≤–Ω–∞</span>`;
                }
                
                linkItem.innerHTML = `
                    <div class="gift-link-header">
                        <span class="gift-link-creator">${link.createdBy}</span>
                        ${statusHtml}
                    </div>
                    <div class="gift-link-code-display">${link.code.substring(0, 30)}...</div>
                    <div class="gift-link-expires">–ò—Å—Ç–µ–∫–∞–µ—Ç: ${expiresDate}</div>
                    ${link.activatedBy ? `<div class="gift-link-activator">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª: ${link.activatedBy}</div>` : ''}
                `;
                
                list.appendChild(linkItem);
            });
        }

        function openCreateGiftLinkModal() {
            if (!currentUser) return;
            
            document.getElementById('createGiftBalance').innerHTML = currentUser.stars + ' ‚≠ê';
            document.getElementById('createGiftBalanceAfter').innerHTML = (currentUser.stars - 100000) + ' ‚≠ê';
            
            const createBtn = document.getElementById('createGiftBtn');
            if (currentUser.stars < 100000) {
                createBtn.disabled = true;
                createBtn.style.opacity = '0.5';
            } else {
                createBtn.disabled = false;
                createBtn.style.opacity = '1';
            }
            
            document.getElementById('createGiftLinkModal').classList.add('active');
        }

        function createGiftLink() {
            if (!currentUser) return;
            
            if (currentUser.stars < 100000) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê! –ù—É–∂–Ω–æ 100,000 ‚≠ê');
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º –∑–≤–µ–∑–¥—ã
            currentUser.stars -= 100000;
            
            // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É
            const code = generateGiftCode();
            const now = new Date();
            const expiresAt = new Date(now.getTime() + 24 * 60 * 60 * 1000); // +24 —á–∞—Å–∞
            
            const giftLink = {
                id: 'gift_' + Date.now(),
                code: code,
                createdBy: currentUser.username,
                createdById: currentUser.id,
                createdAt: now.toISOString(),
                expiresAt: expiresAt.toISOString(),
                activatedBy: null,
                activatedById: null,
                activatedAt: null
            };
            
            giftLinks.push(giftLink);
            
            saveToCloud();
            updateStarBalance();
            renderGiftLinksList();
            closeModal();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
            viewGiftLink(code);
        }

        function viewGiftLink(code) {
            const link = giftLinks.find(l => l.code === code);
            if (!link) return;
            
            currentViewingGiftLink = link;
            
            document.getElementById('viewGiftCreator').innerHTML = link.createdBy;
            document.getElementById('viewGiftCode').innerHTML = link.code;
            document.getElementById('viewGiftCreated').innerHTML = new Date(link.createdAt).toLocaleString();
            document.getElementById('viewGiftExpires').innerHTML = new Date(link.expiresAt).toLocaleString();
            
            const now = new Date();
            const expiresAt = new Date(link.expiresAt);
            const isExpired = expiresAt < now;
            const isActivated = link.activatedBy !== null;
            
            let statusText = '';
            if (isActivated) {
                statusText = '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞';
                document.getElementById('viewGiftStatus').style.color = 'var(--error)';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–∞—Ç–æ—Ä–∞
                document.getElementById('viewGiftActivator').style.display = 'block';
                document.getElementById('viewGiftActivatedBy').innerHTML = link.activatedBy;
                document.getElementById('viewGiftActivatedAt').innerHTML = new Date(link.activatedAt).toLocaleString();
                
            } else if (isExpired) {
                statusText = '–ò—Å—Ç–µ–∫–ª–∞';
                document.getElementById('viewGiftStatus').style.color = 'var(--error)';
                document.getElementById('viewGiftActivator').style.display = 'none';
            } else {
                statusText = '–ê–∫—Ç–∏–≤–Ω–∞';
                document.getElementById('viewGiftStatus').style.color = 'var(--success)';
                document.getElementById('viewGiftActivator').style.display = 'none';
            }
            
            document.getElementById('viewGiftStatus').innerHTML = statusText;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            const activateBtn = document.getElementById('activateGiftBtn');
            if (!isActivated && !isExpired && currentUser && link.createdBy !== currentUser.username) {
                activateBtn.style.display = 'block';
            } else {
                activateBtn.style.display = 'none';
            }
            
            document.getElementById('viewGiftLinkModal').classList.add('active');
        }

        function activateGiftLink() {
            if (!currentViewingGiftLink || !currentUser) return;
            
            const link = currentViewingGiftLink;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∏—Å—Ç–µ–∫–ª–∞ –ª–∏
            const now = new Date();
            const expiresAt = new Date(link.expiresAt);
            if (expiresAt < now) {
                alert('–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å—Å—ã–ª–∫–∏ –∏—Å—Ç–µ–∫');
                closeModal();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏
            if (link.activatedBy) {
                alert('–°—Å—ã–ª–∫–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞');
                closeModal();
                return;
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º
            link.activatedBy = currentUser.username;
            link.activatedById = currentUser.id;
            link.activatedAt = now.toISOString();
            
            // –î–∞–µ–º Premium –Ω–∞ 30 –¥–Ω–µ–π
            activatePremium(30);
            
            saveToCloud();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            viewGiftLink(link.code);
            renderGiftLinksList();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
            const systemChat = chats.find(c => c.id === 3);
            if (systemChat) {
                const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                
                systemChat.messages.push({
                    id: systemChat.messages.length + 1,
                    text: `üëë –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ Premium –ø–æ gift —Å—Å—ã–ª–∫–µ –æ—Ç @${link.createdBy.substring(1)}`,
                    sender: 'them',
                    time: timeStr,
                    date: '–°–µ–≥–æ–¥–Ω—è',
                    reactions: {},
                    starReactions: 0,
                    edited: false
                });
                
                if (currentChatId === 3) {
                    renderMessages();
                }
            }
        }

        function copyGiftLink() {
            if (!currentViewingGiftLink) return;
            
            navigator.clipboard.writeText(currentViewingGiftLink.code).then(() => {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            });
        }

        function parseGiftLink(text) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ gift —Å—Å—ã–ª–∫–∞
            const match = text.match(/\/Gifts-Code\/[A-Za-z0-9]+/);
            if (match) {
                const code = match[0];
                const link = giftLinks.find(l => l.code === code);
                if (link) {
                    viewGiftLink(code);
                    return true;
                }
            }
            return false;
        }

        // ========== –ó–í–ï–ó–î–ù–´–ï –†–ï–ê–ö–¶–ò–ò ==========
        function isChannel(chatId) {
            return chatId < 0 && chatId.toString().startsWith('-100');
        }

        function isGroup(chatId) {
            return chatId < 0 && chatId.toString().startsWith('-4752');
        }

        function openStarReactionModal(msgId) {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat || !isChannel(chat.id)) {
                alert('–ó–≤–µ–∑–¥–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –∫–∞–Ω–∞–ª–∞—Ö');
                return;
            }
            
            const msg = chat.messages.find(m => m.id === msgId);
            if (!msg) return;
            
            currentStarReactionMessage = { chatId: currentChatId, msgId: msgId };
            document.getElementById('starReactionBalance').innerHTML = (currentUser?.stars || 0) + ' ‚≠ê';
            document.getElementById('starReactionAmount').value = 1;
            document.getElementById('starReactionModal').classList.add('active');
        }

        function sendStarReaction() {
            if (!currentStarReactionMessage || !currentUser) return;
            
            const amount = parseInt(document.getElementById('starReactionAmount').value);
            if (isNaN(amount) || amount < 1 || amount > 1000) {
                alert('–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 1000');
                return;
            }
            
            if (currentUser.stars < amount) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê!');
                return;
            }
            
            const chat = chats.find(c => c.id === currentStarReactionMessage.chatId);
            const msg = chat.messages.find(m => m.id === currentStarReactionMessage.msgId);
            
            if (!msg) return;
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º –∑–≤–µ–∑–¥—ã
            currentUser.stars -= amount;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∑–≤–µ–∑–¥–Ω—É—é —Ä–µ–∞–∫—Ü–∏—é
            if (!msg.starReactions) msg.starReactions = 0;
            msg.starReactions += amount;
            
            saveToCloud();
            updateStarBalance();
            renderMessages();
            closeModal();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ä–µ–∞–∫—Ü–∏–∏
            const systemMsg = {
                id: chat.messages.length + 1,
                text: `‚≠ê ${currentUser.username} –ø–æ—Å—Ç–∞–≤–∏–ª(–∞) ${amount} –∑–≤–µ–∑–¥ –Ω–∞ –ø–æ—Å—Ç`,
                sender: 'system',
                time: timeStr,
                date: '–°–µ–≥–æ–¥–Ω—è',
                reactions: {},
                starReactions: 0,
                edited: false
            };
            chat.messages.push(systemMsg);
            
            renderMessages();
        }

        // ========== BOT FATHER ==========
        function openBotFather() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —á–∞—Ç —Å BotFather
            let botFatherChat = chats.find(c => c.username === '@botfather');
            if (!botFatherChat) {
                // –°–æ–∑–¥–∞–µ–º —á–∞—Ç —Å BotFather –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                botFatherChat = {
                    id: chats.length + 1,
                    type: 'bot',
                    name: 'BotFather',
                    username: '@botfather',
                    avatar: 'üë®‚Äçüîß',
                    lastMessage: '–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞',
                    time: new Date().getHours() + ':' + new Date().getMinutes(),
                    unread: 0,
                    online: true,
                    verified: true,
                    createdBy: null,
                    messages: [
                        { 
                            id: 1, 
                            text: '–ü—Ä–∏–≤–µ—Ç! –Ø BotFather. –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º.', 
                            sender: 'them', 
                            time: '00:00', 
                            date: '–°–µ–≥–æ–¥–Ω—è', 
                            reactions: {}, 
                            starReactions: 0,
                            edited: false 
                        },
                        { 
                            id: 2, 
                            text: '–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—ã:\n/newbot - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞\n/mybots - –º–æ–∏ –±–æ—Ç—ã\n/setname - –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è\n/setdescription - –∏–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ\n/token - –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω', 
                            sender: 'them', 
                            time: '00:01', 
                            date: '–°–µ–≥–æ–¥–Ω—è', 
                            reactions: {}, 
                            starReactions: 0,
                            edited: false 
                        }
                    ]
                };
                chats.push(botFatherChat);
            }
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å BotFather
            selectChat(botFatherChat.id);
            document.getElementById('botsPanel').classList.remove('active');
        }

        function toggleBotsPanel() {
            const panel = document.getElementById('botsPanel');
            const starsPanel = document.getElementById('starsPanel');
            const giftsPanel = document.getElementById('giftsPanel');
            const stickerPanel = document.getElementById('stickerPanel');
            const giftLinksPanel = document.getElementById('giftLinksPanel');
            const xostPanel = document.getElementById('xostPanel');
            
            starsPanel.classList.remove('active');
            giftsPanel.classList.remove('active');
            stickerPanel.classList.remove('active');
            giftLinksPanel.classList.remove('active');
            xostPanel.classList.remove('active');
            panel.classList.toggle('active');
            
            if (panel.classList.contains('active')) {
                renderBotsList();
            }
        }

        function renderBotsList() {
            const list = document.getElementById('botsList');
            list.innerHTML = '';
            
            if (bots.length === 0) {
                list.innerHTML = '<div style="color: var(--text-gray); text-align: center; padding: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±–æ—Ç–æ–≤</div>';
                return;
            }
            
            bots.forEach(bot => {
                const botItem = document.createElement('div');
                botItem.className = 'bot-item';
                botItem.onclick = () => openBotSettings(bot);
                
                botItem.innerHTML = `
                    <div class="bot-item-header">
                        <div class="bot-avatar">ü§ñ</div>
                        <div class="bot-info">
                            <div class="bot-name">${bot.name}</div>
                            <div class="bot-username">${bot.username}</div>
                        </div>
                    </div>
                    <div class="bot-description">${bot.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è'}</div>
                    <div class="bot-stats">
                        <span class="bot-stat">üìä ${bot.chats || 0} —á–∞—Ç–æ–≤</span>
                        <span class="bot-stat">üë• ${bot.users || 0} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                    </div>
                    <div class="bot-token" id="token-${bot.id}">–¢–æ–∫–µ–Ω: ${bot.token}</div>
                `;
                
                list.appendChild(botItem);
            });
        }

        function openBotSettings(bot) {
            document.getElementById('botsPanel').classList.remove('active');
            
            document.getElementById('botName').value = bot.name;
            document.getElementById('botUsername').value = bot.username;
            document.getElementById('botDescription').value = bot.description || '';
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã
            if (bot.commands) {
                const commandsText = bot.commands.map(cmd => `${cmd.command} - ${cmd.description}`).join('\n');
                document.getElementById('botCommands').value = commandsText;
            } else {
                document.getElementById('botCommands').value = '';
            }
            
            window.selectedBot = bot;
            document.getElementById('botSettingsModal').classList.add('active');
        }

        function saveBotSettings() {
            const bot = window.selectedBot;
            if (!bot) return;
            
            bot.name = document.getElementById('botName').value;
            bot.description = document.getElementById('botDescription').value;
            
            // –ü–∞—Ä—Å–∏–º –∫–æ–º–∞–Ω–¥—ã
            const commandsText = document.getElementById('botCommands').value;
            bot.commands = commandsText.split('\n')
                .filter(line => line.trim())
                .map(line => {
                    const parts = line.split(' - ');
                    return {
                        command: parts[0].trim(),
                        description: parts[1] || ''
                    };
                });
            
            saveToCloud();
            closeModal();
            renderBotsList();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç —Å –±–æ—Ç–æ–º –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            const botChat = chats.find(c => c.username === bot.username);
            if (botChat) {
                botChat.name = bot.name;
            }
        }

        function sendBotCommand() {
            const command = document.getElementById('botCommand').value.trim();
            const resultDiv = document.getElementById('botCommandResult');
            
            if (!command) return;
            
            if (command === '/newbot') {
                botFatherState.step = 'waiting_name';
                resultDiv.innerHTML = '‚úçÔ∏è –û—Ç–ª–∏—á–Ω–æ! –î–∞–≤–∞–π —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞.\n\n–ü—Ä–∏—à–ª–∏ –º–Ω–µ –∏–º—è –¥–ª—è —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞.';
            } 
            else if (command === '/mybots') {
                if (bots.length === 0) {
                    resultDiv.innerHTML = 'ü§ñ –£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –±–æ—Ç–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–π /newbot —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å.';
                } else {
                    let html = 'ü§ñ –¢–≤–æ–∏ –±–æ—Ç—ã:\n\n';
                    bots.forEach(bot => {
                        html += `‚Ä¢ ${bot.name} (${bot.username})\n  ID: ${bot.id}\n  –¢–æ–∫–µ–Ω: ${bot.token}\n\n`;
                    });
                    resultDiv.innerHTML = html.replace(/\n/g, '<br>');
                }
            }
            else if (command.startsWith('/setname')) {
                if (bots.length === 0) {
                    resultDiv.innerHTML = '‚ùå –£ —Ç–µ–±—è –Ω–µ—Ç –±–æ—Ç–æ–≤.';
                } else {
                    resultDiv.innerHTML = '–í—ã–±–µ—Ä–∏ –±–æ—Ç–∞, —É –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è:\n\n' + 
                        bots.map(b => `‚Ä¢ ${b.name} (${b.username})`).join('\n');
                    botFatherState.step = 'waiting_bot_for_name';
                }
            }
            else if (command.startsWith('/setdescription')) {
                if (bots.length === 0) {
                    resultDiv.innerHTML = '‚ùå –£ —Ç–µ–±—è –Ω–µ—Ç –±–æ—Ç–æ–≤.';
                } else {
                    resultDiv.innerHTML = '–í—ã–±–µ—Ä–∏ –±–æ—Ç–∞, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—á–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ:\n\n' + 
                        bots.map(b => `‚Ä¢ ${b.name} (${b.username})`).join('\n');
                    botFatherState.step = 'waiting_bot_for_desc';
                }
            }
            else if (command.startsWith('/token')) {
                if (bots.length === 0) {
                    resultDiv.innerHTML = '‚ùå –£ —Ç–µ–±—è –Ω–µ—Ç –±–æ—Ç–æ–≤.';
                } else {
                    resultDiv.innerHTML = '–í—ã–±–µ—Ä–∏ –±–æ—Ç–∞, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω:\n\n' + 
                        bots.map(b => `‚Ä¢ ${b.name} (${b.username})`).join('\n');
                    botFatherState.step = 'waiting_bot_for_token';
                }
            }
            else if (command.startsWith('/revoke')) {
                if (bots.length === 0) {
                    resultDiv.innerHTML = '‚ùå –£ —Ç–µ–±—è –Ω–µ—Ç –±–æ—Ç–æ–≤.';
                } else {
                    resultDiv.innerHTML = '–í—ã–±–µ—Ä–∏ –±–æ—Ç–∞, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—á–µ—à—å –æ—Ç–æ–∑–≤–∞—Ç—å —Ç–æ–∫–µ–Ω:\n\n' + 
                        bots.map(b => `‚Ä¢ ${b.name} (${b.username})`).join('\n');
                    botFatherState.step = 'waiting_bot_for_revoke';
                }
            }
            else if (command.startsWith('/deletebot')) {
                if (bots.length === 0) {
                    resultDiv.innerHTML = '‚ùå –£ —Ç–µ–±—è –Ω–µ—Ç –±–æ—Ç–æ–≤.';
                } else {
                    resultDiv.innerHTML = '‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –£–¥–∞–ª–µ–Ω–∏–µ –±–æ—Ç–∞ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.\n\n–í—ã–±–µ—Ä–∏ –±–æ—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:\n\n' + 
                        bots.map(b => `‚Ä¢ ${b.name} (${b.username})`).join('\n');
                    botFatherState.step = 'waiting_bot_for_delete';
                }
            }
            else {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã
                if (botFatherState.step === 'waiting_name') {
                    botFatherState.tempBot = {
                        name: command,
                        username: '',
                        description: '',
                        commands: []
                    };
                    botFatherState.step = 'waiting_username';
                    resultDiv.innerHTML = `üëå –û—Ç–ª–∏—á–Ω–æ. –¢–µ–ø–µ—Ä—å –ø—Ä–∏—à–ª–∏ –º–Ω–µ —é–∑–µ—Ä–Ω–µ–π–º –¥–ª—è —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞.\n\n–û–Ω –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ "bot". –ù–∞–ø—Ä–∏–º–µ—Ä: ${command.replace(/\s+/g, '')}Bot`;
                }
                else if (botFatherState.step === 'waiting_username') {
                    let username = command;
                    if (!username.startsWith('@')) {
                        username = '@' + username;
                    }
                    
                    if (!isBotUsernameValid(username)) {
                        resultDiv.innerHTML = '‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —é–∑–µ—Ä–Ω–µ–π–º–∞. –û–Ω –¥–æ–ª–∂–µ–Ω —Å–æ—Å—Ç–æ—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –±—É–∫–≤, —Ü–∏—Ñ—Ä, _ –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ "bot". –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.';
                        return;
                    }
                    
                    if (isUsernameTaken(username)) {
                        resultDiv.innerHTML = '‚ùå –≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π.';
                        return;
                    }
                    
                    // –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
                    const botId = 'bot_' + Date.now();
                    const token = Math.random().toString(36).substring(2, 15) + ':' + Math.random().toString(36).substring(2, 30);
                    
                    const newBot = {
                        id: botId,
                        name: botFatherState.tempBot.name,
                        username: username,
                        description: '',
                        token: token,
                        commands: [],
                        chats: 0,
                        users: 0,
                        createdBy: currentUser?.username,
                        createdAt: new Date().toISOString()
                    };
                    
                    bots.push(newBot);
                    takenUsernames.push(username);
                    
                    // –°–æ–∑–¥–∞–µ–º —á–∞—Ç —Å –±–æ—Ç–æ–º
                    const newChat = {
                        id: chats.length + 1,
                        type: 'bot',
                        name: newBot.name,
                        username: username,
                        avatar: 'ü§ñ',
                        lastMessage: '–ë–æ—Ç —Å–æ–∑–¥–∞–Ω!',
                        time: '—Ç–æ–ª—å–∫–æ —á—Ç–æ',
                        unread: 0,
                        online: true,
                        verified: false,
                        createdBy: currentUser?.username,
                        botId: botId,
                        messages: [
                            { 
                                id: 1, 
                                text: '–ü—Ä–∏–≤–µ—Ç! –Ø –Ω–æ–≤—ã–π –±–æ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π /help —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –º–æ–∏ –∫–æ–º–∞–Ω–¥—ã.', 
                                sender: 'them', 
                                time: '—Ç–æ–ª—å–∫–æ —á—Ç–æ', 
                                date: '–°–µ–≥–æ–¥–Ω—è',
                                reactions: {}, 
                                starReactions: 0,
                                edited: false 
                            }
                        ]
                    };
                    
                    chats.push(newChat);
                    
                    resultDiv.innerHTML = `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –¢–≤–æ–π –±–æ—Ç —Å–æ–∑–¥–∞–Ω.\n\n–ò–º—è: ${newBot.name}\n–Æ–∑–µ—Ä–Ω–µ–π–º: ${username}\n\n–¢–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API:\n<code>${token}</code>\n\n–°–æ—Ö—Ä–∞–Ω–∏ –µ–≥–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ!`;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç —Å BotFather
                    const botFatherChat = chats.find(c => c.username === '@botfather');
                    if (botFatherChat) {
                        const now = new Date();
                        const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                        
                        botFatherChat.messages.push({
                            id: botFatherChat.messages.length + 1,
                            text: `‚úÖ –ë–æ—Ç @${username.substring(1)} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!\n\n–ò–º—è: ${newBot.name}\n–¢–æ–∫–µ–Ω: ${token}`,
                            sender: 'them',
                            time: timeStr,
                            date: '–°–µ–≥–æ–¥–Ω—è',
                            reactions: {},
                            starReactions: 0,
                            edited: false
                        });
                        
                        if (currentChatId === botFatherChat.id) {
                            renderMessages();
                        }
                    }
                    
                    saveToCloud();
                    botFatherState.step = null;
                    botFatherState.tempBot = null;
                }
                else if (botFatherState.step === 'waiting_bot_for_name') {
                    // –ò—â–µ–º –±–æ—Ç–∞ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ —é–∑–µ—Ä–Ω–µ–π–º—É
                    const searchStr = command.toLowerCase();
                    const bot = bots.find(b => 
                        b.name.toLowerCase().includes(searchStr) || 
                        b.username.toLowerCase().includes(searchStr)
                    );
                    
                    if (bot) {
                        botFatherState.tempBot = bot;
                        botFatherState.step = 'waiting_new_name';
                        resultDiv.innerHTML = `‚úçÔ∏è –ü—Ä–∏—à–ª–∏ –º–Ω–µ –Ω–æ–≤–æ–µ –∏–º—è –¥–ª—è –±–æ—Ç–∞ ${bot.name}`;
                    } else {
                        resultDiv.innerHTML = '‚ùå –ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.';
                    }
                }
                else if (botFatherState.step === 'waiting_new_name') {
                    const bot = botFatherState.tempBot;
                    const oldName = bot.name;
                    bot.name = command;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ —á–∞—Ç–∞—Ö
                    const botChat = chats.find(c => c.username === bot.username);
                    if (botChat) {
                        botChat.name = command;
                    }
                    
                    saveToCloud();
                    
                    resultDiv.innerHTML = `‚úÖ –ò–º—è –±–æ—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–æ —Å "${oldName}" –Ω–∞ "${command}"`;
                    botFatherState.step = null;
                    botFatherState.tempBot = null;
                }
                else if (botFatherState.step === 'waiting_bot_for_desc') {
                    const searchStr = command.toLowerCase();
                    const bot = bots.find(b => 
                        b.name.toLowerCase().includes(searchStr) || 
                        b.username.toLowerCase().includes(searchStr)
                    );
                    
                    if (bot) {
                        botFatherState.tempBot = bot;
                        botFatherState.step = 'waiting_new_desc';
                        resultDiv.innerHTML = `‚úçÔ∏è –ü—Ä–∏—à–ª–∏ –º–Ω–µ –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –±–æ—Ç–∞ ${bot.name}`;
                    } else {
                        resultDiv.innerHTML = '‚ùå –ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.';
                    }
                }
                else if (botFatherState.step === 'waiting_new_desc') {
                    const bot = botFatherState.tempBot;
                    bot.description = command;
                    
                    saveToCloud();
                    
                    resultDiv.innerHTML = `‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞ ${bot.name} –æ–±–Ω–æ–≤–ª–µ–Ω–æ`;
                    botFatherState.step = null;
                    botFatherState.tempBot = null;
                }
                else if (botFatherState.step === 'waiting_bot_for_token') {
                    const searchStr = command.toLowerCase();
                    const bot = bots.find(b => 
                        b.name.toLowerCase().includes(searchStr) || 
                        b.username.toLowerCase().includes(searchStr)
                    );
                    
                    if (bot) {
                        resultDiv.innerHTML = `üîë –¢–æ–∫–µ–Ω –¥–ª—è –±–æ—Ç–∞ ${bot.name}:\n<code>${bot.token}</code>`;
                        botFatherState.step = null;
                    } else {
                        resultDiv.innerHTML = '‚ùå –ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.';
                    }
                }
                else if (botFatherState.step === 'waiting_bot_for_revoke') {
                    const searchStr = command.toLowerCase();
                    const bot = bots.find(b => 
                        b.name.toLowerCase().includes(searchStr) || 
                        b.username.toLowerCase().includes(searchStr)
                    );
                    
                    if (bot) {
                        const oldToken = bot.token;
                        bot.token = Math.random().toString(36).substring(2, 15) + ':' + Math.random().toString(36).substring(2, 30);
                        
                        saveToCloud();
                        
                        resultDiv.innerHTML = `üîÑ –¢–æ–∫–µ–Ω –¥–ª—è –±–æ—Ç–∞ ${bot.name} –æ—Ç–æ–∑–≤–∞–Ω.\n\n–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω:\n<code>${bot.token}</code>\n\n–°—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.`;
                        botFatherState.step = null;
                    } else {
                        resultDiv.innerHTML = '‚ùå –ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.';
                    }
                }
                else if (botFatherState.step === 'waiting_bot_for_delete') {
                    const searchStr = command.toLowerCase();
                    const bot = bots.find(b => 
                        b.name.toLowerCase().includes(searchStr) || 
                        b.username.toLowerCase().includes(searchStr)
                    );
                    
                    if (bot) {
                        // –£–¥–∞–ª—è–µ–º –±–æ—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
                        const botIndex = bots.findIndex(b => b.id === bot.id);
                        if (botIndex !== -1) {
                            bots.splice(botIndex, 1);
                        }
                        
                        // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —é–∑–µ—Ä–Ω–µ–π–º
                        takenUsernames = takenUsernames.filter(u => u !== bot.username);
                        
                        // –£–¥–∞–ª—è–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–∞—Ç —Å –±–æ—Ç–æ–º
                        const chatIndex = chats.findIndex(c => c.username === bot.username);
                        if (chatIndex !== -1) {
                            // –ú–æ–∂–Ω–æ –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å, –ª–∏–±–æ –ø–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–π
                            chats.splice(chatIndex, 1);
                        }
                        
                        saveToCloud();
                        
                        resultDiv.innerHTML = `üóëÔ∏è –ë–æ—Ç ${bot.name} (${bot.username}) —É–¥–∞–ª–µ–Ω.`;
                        botFatherState.step = null;
                    } else {
                        resultDiv.innerHTML = '‚ùå –ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.';
                    }
                }
                else {
                    resultDiv.innerHTML = '‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n/newbot - —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞\n/mybots - –º–æ–∏ –±–æ—Ç—ã\n/setname - –∏–∑–º–µ–Ω–∏—Ç—å –∏–º—è\n/setdescription - –∏–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ\n/token - –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω\n/revoke - –æ—Ç–æ–∑–≤–∞—Ç—å —Ç–æ–∫–µ–Ω\n/deletebot - —É–¥–∞–ª–∏—Ç—å –±–æ—Ç–∞';
                }
            }
            
            document.getElementById('botCommand').value = '';
        }

        // ========== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ==========
        function sendCode() {
            const phone = document.getElementById('phoneInput').value;
            if (phone) {
                document.getElementById('phoneScreen').style.display = 'none';
                document.getElementById('codeScreen').style.display = 'block';
            }
        }

        function verifyCode() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º 2FA –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞
            if (twoFAEnabled && currentUser) {
                document.getElementById('twofaModal').classList.add('active');
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (!currentUser) {
                    document.getElementById('registerModal').classList.add('active');
                } else {
                    finishAuth();
                }
            }
        }

        function verify2FA() {
            const password = document.getElementById('twofaInput').value;
            if (password === twoFAPassword) {
                document.getElementById('twofaModal').classList.remove('active');
                finishAuth();
            } else {
                document.getElementById('twofaError').innerText = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
            }
        }

        function registerUser() {
            const name = document.getElementById('registerName').value.trim();
            const lastName = document.getElementById('registerLastName').value.trim();
            const username = document.getElementById('registerUsername').value.trim();

            if (!name) {
                document.getElementById('registerError').innerText = '–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ';
                return;
            }

            if (!username.startsWith('@')) {
                document.getElementById('registerError').innerText = '–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @';
                return;
            }

            if (!isUsernameValid(username)) {
                document.getElementById('registerError').innerText = '–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _';
                return;
            }

            if (username.length < 6) { // @ + –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤
                document.getElementById('registerError').innerText = '–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤ (–±–µ–∑ @)';
                return;
            }

            if (isUsernameTaken(username)) {
                document.getElementById('registerError').innerText = '–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç';
                return;
            }

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –∞–∫–∫–∞—É–Ω—Ç–∞
            const userId = Math.floor(Math.random() * 1000000) + 1;
            
            currentUser = {
                id: userId,
                name: name,
                lastName: lastName || '',
                username: username,
                phone: '+7 999 123-45-67',
                bio: '',
                stars: 1000000, // –ù–∞—á–∏–Ω–∞–µ–º —Å 1–ú –∑–≤–µ–∑–¥ –¥–ª—è —Ç–µ—Å—Ç–∞
                gifts: [],
                premium: null
            };

            takenUsernames.push(username);
            saveToCloud();
            
            document.getElementById('registerModal').classList.remove('active');
            finishAuth();
        }

        function finishAuth() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainInterface').style.opacity = '1';
            isAuthenticated = true;
            
            renderChats();
            selectChat(3);
            updateStarBalance();
            renderStarsGrid();
            renderGiftsGrid();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å 2FA –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
            const twofaToggle = document.getElementById('twofaToggle');
            if (twofaToggle) {
                twofaToggle.checked = twoFAEnabled;
                document.getElementById('twofaSetup').style.display = twoFAEnabled ? 'block' : 'none';
            }
            
            updatePremiumBadge();
            checkXostPayments();
        }

        // ========== –ó–í–ï–ó–î–´ ==========
        function updateStarBalance() {
            const balance = currentUser?.stars || 0;
            document.getElementById('headerStarBalance').innerText = balance + ' ‚≠ê';
            document.getElementById('starsBalanceDisplay').innerText = balance + ' ‚≠ê';
            if (document.getElementById('giftsBalanceDisplay')) {
                document.getElementById('giftsBalanceDisplay').innerText = '–ë–∞–ª–∞–Ω—Å: ' + balance + ' ‚≠ê';
            }
        }

        function toggleStarsPanel() {
            const panel = document.getElementById('starsPanel');
            const giftsPanel = document.getElementById('giftsPanel');
            const stickerPanel = document.getElementById('stickerPanel');
            const botsPanel = document.getElementById('botsPanel');
            const giftLinksPanel = document.getElementById('giftLinksPanel');
            const xostPanel = document.getElementById('xostPanel');
            
            giftsPanel.classList.remove('active');
            stickerPanel.classList.remove('active');
            botsPanel.classList.remove('active');
            giftLinksPanel.classList.remove('active');
            xostPanel.classList.remove('active');
            panel.classList.toggle('active');
        }

        function renderStarsGrid() {
            const grid = document.getElementById('starsGrid');
            grid.innerHTML = '';
            
            starNominals.forEach(amount => {
                const item = document.createElement('div');
                item.className = 'star-item';
                item.onclick = () => addStars(amount);
                item.innerHTML = `
                    <div class="star-icon">‚≠ê</div>
                    <div class="star-value">${amount}</div>
                `;
                grid.appendChild(item);
            });
        }

        function addStars(amount) {
            if (!currentUser) return;
            currentUser.stars = (currentUser.stars || 0) + amount;
            saveToCloud();
            updateStarBalance();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            alert(`–ü–æ–ª—É—á–µ–Ω–æ ${amount} ‚≠ê!`);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π —á–∞—Ç
            const systemChat = chats.find(c => c.id === 3);
            if (systemChat) {
                const now = new Date();
                const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                
                systemChat.messages.push({
                    id: systemChat.messages.length + 1,
                    text: `‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} ‚≠ê`,
                    sender: 'them',
                    time: timeStr,
                    date: '–°–µ–≥–æ–¥–Ω—è',
                    reactions: {},
                    starReactions: 0,
                    edited: false
                });
                
                if (currentChatId === 3) {
                    renderMessages();
                }
            }
        }

        // ========== –ü–û–î–ê–†–ö–ò ==========
        function toggleGiftsPanel() {
            const panel = document.getElementById('giftsPanel');
            const starsPanel = document.getElementById('starsPanel');
            const stickerPanel = document.getElementById('stickerPanel');
            const botsPanel = document.getElementById('botsPanel');
            const giftLinksPanel = document.getElementById('giftLinksPanel');
            const xostPanel = document.getElementById('xostPanel');
            
            starsPanel.classList.remove('active');
            stickerPanel.classList.remove('active');
            botsPanel.classList.remove('active');
            giftLinksPanel.classList.remove('active');
            xostPanel.classList.remove('active');
            panel.classList.toggle('active');
            updateStarBalance();
        }

        function renderGiftsGrid() {
            const grid = document.getElementById('giftsGrid');
            grid.innerHTML = '';
            
            availableGifts.forEach(gift => {
                const item = document.createElement('div');
                item.className = 'gift-item';
                item.onclick = () => purchaseGift(gift);
                item.innerHTML = `
                    <div class="gift-icon">${gift.icon}</div>
                    <div class="gift-name">${gift.name}</div>
                    <div class="gift-price">${gift.price} ‚≠ê</div>
                `;
                grid.appendChild(item);
            });
        }

        function purchaseGift(gift) {
            if (!currentUser) return;
            
            if (currentUser.stars < gift.price) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚≠ê! –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–∫—É–ø–∫–µ
            window.pendingGift = gift;
            document.getElementById('purchaseText').innerHTML = `–ö—É–ø–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫ "${gift.name}" –∑–∞ ${gift.price} ‚≠ê?`;
            document.getElementById('confirmPurchaseModal').classList.add('active');
        }

        function confirmGiftPurchase() {
            const gift = window.pendingGift;
            if (!gift || !currentUser) return;
            
            if (currentUser.stars >= gift.price) {
                // –°–ø–∏—Å—ã–≤–∞–µ–º –∑–≤–µ–∑–¥—ã
                currentUser.stars -= gift.price;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–∞—Ä–æ–∫ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
                if (!currentUser.gifts) currentUser.gifts = [];
                currentUser.gifts.push({
                    id: gift.id,
                    name: gift.name,
                    icon: gift.icon,
                    price: gift.price,
                    date: new Date().toISOString()
                });
                
                saveToCloud();
                updateStarBalance();
                
                // –ï—Å–ª–∏ —ç—Ç–æ —Ç–æ—Ä—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –≤ Xost Bots
                if (gift.name === '–¢–æ—Ä—Ç') {
                    xostRequests.cakes = (xostRequests.cakes || 0) + 1;
                    xostRequests.used = 0; // –û–±–Ω—É–ª—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
                    addXostLog('–û–ø–ª–∞—Ç–∞', '–ü–æ–ª—É—á–µ–Ω 1 üéÇ —Ç–æ—Ä—Ç');
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                alert(`üéÅ –ü–æ–¥–∞—Ä–æ–∫ "${gift.name}" –∫—É–ø–ª–µ–Ω!`);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ç–µ–∫—É—â–∏–π —á–∞—Ç
                if (currentChatId) {
                    sendGiftMessage(gift);
                }
            }
            
            closeModal();
            document.getElementById('giftsPanel').classList.remove('active');
        }

        function sendGiftMessage(gift) {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat || !canSendMessage(chat)) return;
            
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            
            chat.messages.push({
                id: chat.messages.length + 1,
                type: 'gift',
                gift: gift,
                text: `üéÅ –ü–æ–¥–∞—Ä–æ–∫: ${gift.name} ${gift.icon}`,
                sender: 'me',
                time: timeStr,
                date: '–°–µ–≥–æ–¥–Ω—è',
                reactions: {},
                starReactions: 0,
                edited: false
            });
            
            chat.lastMessage = `üéÅ –ü–æ–¥–∞—Ä–æ–∫: ${gift.name}`;
            chat.time = timeStr;
            
            renderMessages();
            renderChats();
            saveToCloud();
        }

        // ========== –ß–ê–¢–´ ==========
        function renderChats() {
            const list = document.getElementById('chatsList');
            list.innerHTML = '';

            chats.forEach(chat => {
                const item = document.createElement('div');
                item.className = `chat-item ${chat.id === currentChatId ? 'active' : ''}`;
                item.dataset.id = chat.id;
                item.dataset.name = chat.name.toLowerCase();
                item.dataset.type = chat.type;
                item.onclick = () => selectChat(chat.id);

                const lastMsg = chat.messages[chat.messages.length - 1] || {};
                
                let previewText = lastMsg.text || '';
                if (lastMsg.type === 'file') {
                    previewText = 'üìé ' + lastMsg.fileName;
                } else if (lastMsg.type === 'sticker') {
                    previewText = 'üòä –°—Ç–∏–∫–µ—Ä';
                } else if (lastMsg.type === 'gift') {
                    previewText = 'üéÅ ' + lastMsg.gift.name;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –∫–∞–Ω–∞–ª–∞
                const isVerified = chat.verified || (chat.type === 'channel' && isChannelVerified(chat.username));
                
                // ID –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                let idDisplay = '';
                if (chat.type === 'channel') {
                    idDisplay = `<span style="font-size: 10px; color: var(--text-muted);">ID: ${chat.id}</span>`;
                } else if (chat.type === 'group') {
                    idDisplay = `<span style="font-size: 10px; color: var(--text-muted);">ID: ${chat.id}</span>`;
                }
                
                item.innerHTML = `
                    <div class="chat-avatar">
                        ${chat.avatar}
                        ${chat.type === 'bot' ? '<span class="bot-badge">ü§ñ</span>' : ''}
                        ${chat.online && chat.type === 'private' ? '<span class="online-badge"></span>' : ''}
                    </div>
                    <div class="chat-info">
                        <div class="chat-row">
                            <span class="chat-name">
                                ${chat.name}
                                ${chat.type === 'bot' ? '<span class="bot-tag">–±–æ—Ç</span>' : ''}
                                ${isVerified ? '<span class="verified">‚úì</span>' : ''}
                                ${idDisplay}
                            </span>
                            <span class="chat-time">${chat.time}</span>
                        </div>
                        <div class="chat-preview">
                            <span>${previewText.substring(0, 25)}${previewText.length > 25 ? '...' : ''}</span>
                            ${chat.unread > 0 ? `<span class="unread-count">${chat.unread}</span>` : ''}
                        </div>
                    </div>
                `;

                list.appendChild(item);
            });
        }

        function selectChat(chatId) {
            currentChatId = chatId;
            
            const chat = chats.find(c => c.id === chatId);
            if (chat) {
                chat.unread = 0;
                renderMessages();
                renderChats();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–∂–Ω–æ –ª–∏ –ø–∏—Å–∞—Ç—å
                const canWrite = canSendMessage(chat);
                document.getElementById('inputArea').style.display = canWrite ? 'flex' : 'none';
            }
        }

        function canSendMessage(chat) {
            if (chat.type === 'channel') {
                // –í –∫–∞–Ω–∞–ª –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —è –µ–≥–æ —Å–æ–∑–¥–∞–ª
                return myCreatedChats.includes(chat.id);
            }
            if (chat.type === 'bot') {
                // –í –±–æ—Ç–∞ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤—Å–µ–≥–¥–∞
                return true;
            }
            if (chat.type === 'group') {
                // –í –≥—Ä—É–ø–ø—É –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤—Å–µ–≥–¥–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
                return true;
            }
            // –í –ª–∏—á–∫—É –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ
            return true;
        }

        // ========== –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–û–û–ë–©–ï–ù–ò–ô ==========
        
        // –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
        function replyToMessage(btn) {
            const msgWrapper = btn.closest('.message-wrapper');
            const msgText = msgWrapper.querySelector('.message-text').textContent;
            const msgId = msgWrapper.dataset.msgId;
            
            replyingToMessage = {
                id: parseInt(msgId),
                text: msgText.substring(0, 50) + (msgText.length > 50 ? '...' : '')
            };
            
            document.getElementById('replyText').textContent = replyingToMessage.text;
            document.getElementById('replyContainer').style.display = 'block';
            document.getElementById('messageInput').focus();
        }

        // –û—Ç–º–µ–Ω–∞ –æ—Ç–≤–µ—Ç–∞
        function cancelReply() {
            replyingToMessage = null;
            document.getElementById('replyContainer').style.display = 'none';
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        function editMessage(btn) {
            const msgWrapper = btn.closest('.message-wrapper');
            const msgId = parseInt(msgWrapper.dataset.msgId);
            const chat = chats.find(c => c.id === currentChatId);
            const msg = chat.messages.find(m => m.id === msgId);
            
            if (msg && msg.sender === 'me') {
                editingMessage = msg;
                document.getElementById('messageInput').value = msg.text;
                document.getElementById('messageInput').focus();
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        function deleteMessage(btn) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?')) return;
            
            const msgWrapper = btn.closest('.message-wrapper');
            const msgId = parseInt(msgWrapper.dataset.msgId);
            const chat = chats.find(c => c.id === currentChatId);
            
            const msgIndex = chat.messages.findIndex(m => m.id === msgId);
            if (msgIndex !== -1) {
                chat.messages.splice(msgIndex, 1);
                renderMessages();
                saveToCloud();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç–æ–≤
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentChatId) return;

            const chat = chats.find(c => c.id === currentChatId);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–∂–Ω–æ –ª–∏ –ø–∏—Å–∞—Ç—å
            if (!canSendMessage(chat)) {
                alert('–ù–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å –≤ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç gift —Å—Å—ã–ª–∫–æ–π
            if (parseGiftLink(text)) {
                input.value = '';
                return;
            }

            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

            if (editingMessage) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                editingMessage.text = text;
                editingMessage.edited = true;
                editingMessage = null;
            } else {
                // –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                const newMsg = {
                    id: chat.messages.length + 1,
                    text: text,
                    sender: 'me',
                    time: timeStr,
                    date: '–°–µ–≥–æ–¥–Ω—è',
                    reactions: {},
                    starReactions: 0,
                    edited: false
                };

                // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–≤–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                if (replyingToMessage) {
                    newMsg.replyTo = replyingToMessage;
                }

                chat.messages.push(newMsg);
                chat.lastMessage = text;
                chat.time = timeStr;
            }

            input.value = '';
            cancelReply(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
            renderMessages();
            renderChats();
            saveToCloud();

            // –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç –æ—Ç –±–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
            if (currentChatId === 3 && !editingMessage) {
                setTimeout(() => {
                    const response = botResponses[Math.floor(Math.random() * botResponses.length)];
                    const botTime = new Date().getHours().toString().padStart(2, '0') + ':' + 
                                   new Date().getMinutes().toString().padStart(2, '0');

                    chat.messages.push({
                        id: chat.messages.length + 1,
                        text: response,
                        sender: 'them',
                        time: botTime,
                        date: '–°–µ–≥–æ–¥–Ω—è',
                        reactions: {},
                        starReactions: 0,
                        edited: false
                    });

                    renderMessages();
                    renderChats();
                    saveToCloud();
                }, 1500);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è –±–æ—Ç–æ–≤
            if (chat.type === 'bot' && chat.botId) {
                processBotCommand(chat, text);
            }
        }

        function processBotCommand(chat, command) {
            const bot = bots.find(b => b.id === chat.botId);
            if (!bot) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
            if (command === '/start') {
                setTimeout(() => {
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                    
                    chat.messages.push({
                        id: chat.messages.length + 1,
                        text: `üëã –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç ${bot.name}. –ò—Å–ø–æ–ª—å–∑—É–π /help —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –º–æ–∏ –∫–æ–º–∞–Ω–¥—ã.`,
                        sender: 'them',
                        time: timeStr,
                        date: '–°–µ–≥–æ–¥–Ω—è',
                        reactions: {},
                        starReactions: 0,
                        edited: false
                    });
                    
                    renderMessages();
                    saveToCloud();
                }, 1000);
            }
            else if (command === '/help' && bot.commands && bot.commands.length > 0) {
                setTimeout(() => {
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                    
                    let helpText = 'üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n';
                    bot.commands.forEach(cmd => {
                        helpText += `${cmd.command} - ${cmd.description}\n`;
                    });
                    
                    chat.messages.push({
                        id: chat.messages.length + 1,
                        text: helpText,
                        sender: 'them',
                        time: timeStr,
                        date: '–°–µ–≥–æ–¥–Ω—è',
                        reactions: {},
                        starReactions: 0,
                        edited: false
                    });
                    
                    renderMessages();
                    saveToCloud();
                }, 1000);
            }
            else if (command === '/help') {
                setTimeout(() => {
                    const now = new Date();
                    const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
                    
                    chat.messages.push({
                        id: chat.messages.length + 1,
                        text: 'üìã –£ —ç—Ç–æ–≥–æ –±–æ—Ç–∞ –ø–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–∞–Ω–¥. –ò—Å–ø–æ–ª—å–∑—É–π /start –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è.',
                        sender: 'them',
                        time: timeStr,
                        date: '–°–µ–≥–æ–¥–Ω—è',
                        reactions: {},
                        starReactions: 0,
                        edited: false
                    });
                    
                    renderMessages();
                    saveToCloud();
                }, 1000);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –Ω–æ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
        function renderMessages() {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return;

            const area = document.getElementById('messagesArea');
            area.innerHTML = '';

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –µ—Å–ª–∏ –∫–∞–Ω–∞–ª —Å _vf
            const isVerified = chat.verified || (chat.type === 'channel' && isChannelVerified(chat.username));
            document.getElementById('verifiedBadge').style.display = isVerified ? 'inline' : 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º ID —á–∞—Ç–∞
            document.getElementById('currentChatStatus').innerHTML = `${chat.type} (ID: ${chat.id})`;

            chat.messages.forEach((msg, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = `message-wrapper ${msg.sender === 'me' || (msg.sender === 'channel' && chat.createdBy === currentUser?.username) ? 'outgoing' : 'incoming'}`;
                wrapper.dataset.msgId = msg.id;

                // –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏—Ç–∏—Ä—É–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å
                let replyHtml = '';
                if (msg.replyTo) {
                    replyHtml = `<div class="reply-context" onclick="scrollToMessage(${msg.replyTo.id})">‚Ü©Ô∏è ${msg.replyTo.text}</div>`;
                }

                let content = '';
                
                if (msg.type === 'file') {
                    content = `
                        <div class="file-attachment" onclick="downloadFile('${msg.fileName}')">
                            <span class="file-icon">üìé</span>
                            <div>
                                <div class="file-name">${msg.fileName}</div>
                                <div class="file-size">${msg.fileSize || '1.2 MB'}</div>
                            </div>
                        </div>
                    `;
                } else if (msg.type === 'sticker') {
                    content = `<div style="font-size: 64px;">${msg.text}</div>`;
                } else if (msg.type === 'gift') {
                    content = `
                        <div style="display: flex; flex-direction: column; align-items: center; padding: 10px;">
                            <div style="font-size: 48px;">${msg.gift.icon}</div>
                            <div style="font-weight: 500; margin-top: 5px;">${msg.gift.name}</div>
                            <div style="font-size: 12px; color: var(--star);">${msg.gift.price} ‚≠ê</div>
                        </div>
                    `;
                } else {
                    // –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
                    let textDisplay = msg.text;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ gift —Å—Å—ã–ª–∫–∞ –≤ —Ç–µ–∫—Å—Ç–µ
                    if (msg.text.includes('/Gifts-Code/')) {
                        textDisplay = msg.text.replace(/\/Gifts-Code\/[A-Za-z0-9]+/g, match => {
                            return `<span class="gift-link" onclick="parseGiftLink('${match}')">${match}</span>`;
                        });
                    }
                    
                    if (msg.edited) {
                        textDisplay += ' <span class="edited-badge">—Ä–µ–¥.</span>';
                    }
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ –±–æ—Ç –∏ –µ—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∫–æ–º–∞–Ω–¥
                    if (chat.type === 'bot' && msg.sender === 'them' && msg.text.includes('–∫–æ–º–∞–Ω–¥—ã')) {
                        const bot = bots.find(b => b.id === chat.botId);
                        if (bot && bot.commands && bot.commands.length > 0) {
                            let commandsHtml = '<div class="bot-commands">';
                            bot.commands.forEach(cmd => {
                                commandsHtml += `<div class="bot-command" onclick="sendBotCommandMessage('${cmd.command}')">${cmd.command}</div>`;
                            });
                            commandsHtml += '</div>';
                            textDisplay += commandsHtml;
                        }
                    }
                    
                    content = textDisplay;
                }

                let senderName = '';
                if (msg.name && chat.type === 'group') {
                    senderName = `<div style="color: ${getColorForUser(msg.name)}; font-size: 12px; margin-bottom: 2px;">${msg.name}</div>`;
                }

                // –†–µ–∞–∫—Ü–∏–∏
                let reactionsHtml = '';
                if (msg.reactions && Object.keys(msg.reactions).length > 0) {
                    reactionsHtml = '<div class="message-reactions">';
                    for (let [emoji, users] of Object.entries(msg.reactions)) {
                        reactionsHtml += `<div class="reaction" onclick="addReaction(${chat.id}, ${msg.id}, '${emoji}')">${emoji} ${users.length}</div>`;
                    }
                    reactionsHtml += '</div>';
                }
                
                // –ó–≤–µ–∑–¥–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞–Ω–∞–ª–æ–≤)
                let starReactionsHtml = '';
                if (isChannel(chat.id) && msg.starReactions > 0) {
                    starReactionsHtml = `<div class="star-reaction-total" onclick="openStarReactionModal(${msg.id})">‚≠ê ${msg.starReactions}</div>`;
                }

                wrapper.innerHTML = `
                    ${replyHtml}
                    <div class="message-bubble">
                        ${senderName}
                        <div class="message-text">${content}</div>
                        <div class="message-meta">
                            <span>${msg.time}</span>
                            ${msg.sender === 'me' ? '<span>‚úì‚úì</span>' : ''}
                        </div>
                        <div class="message-actions">
                            <div class="action-btn" onclick="replyToMessage(this)">‚Ü©Ô∏è</div>
                            ${msg.sender === 'me' ? '<div class="action-btn" onclick="editMessage(this)">‚úèÔ∏è</div>' : ''}
                            ${msg.sender === 'me' ? '<div class="action-btn" onclick="deleteMessage(this)">üóëÔ∏è</div>' : ''}
                        </div>
                    </div>
                    ${reactionsHtml}
                    ${starReactionsHtml}
                    <div class="reaction-picker">
                        <div class="reaction-emoji" onclick="addReaction(${chat.id}, ${msg.id}, '‚ù§Ô∏è')">‚ù§Ô∏è</div>
                        <div class="reaction-emoji" onclick="addReaction(${chat.id}, ${msg.id}, 'üî•')">üî•</div>
                        <div class="reaction-emoji" onclick="addReaction(${chat.id}, ${msg.id}, 'üëç')">üëç</div>
                        <div class="reaction-emoji" onclick="addReaction(${chat.id}, ${msg.id}, 'üëé')">üëé</div>
                        <div class="reaction-emoji" onclick="addReaction(${chat.id}, ${msg.id}, 'üòÇ')">üòÇ</div>
                        <div class="reaction-emoji" onclick="addReaction(${chat.id}, ${msg.id}, 'ü•≥')">ü•≥</div>
                    </div>
                    ${isChannel(chat.id) ? `
                    <div class="star-reaction-picker">
                        <div class="star-amount" onclick="openStarReactionModal(${msg.id})">‚≠ê 1</div>
                        <div class="star-amount" onclick="openStarReactionModalWithAmount(${msg.id}, 5)">‚≠ê 5</div>
                        <div class="star-amount" onclick="openStarReactionModalWithAmount(${msg.id}, 10)">‚≠ê 10</div>
                        <div class="star-amount" onclick="openStarReactionModalWithAmount(${msg.id}, 50)">‚≠ê 50</div>
                        <div class="star-amount" onclick="openStarReactionModalWithAmount(${msg.id}, 100)">‚≠ê 100</div>
                    </div>
                    ` : ''}
                `;

                area.appendChild(wrapper);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–ø–∫—É
            document.getElementById('currentChatName').innerText = chat.name;
            document.getElementById('currentChatAvatar').innerText = chat.avatar;
            
            // –°—Ç–∞—Ç—É—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            let status = '';
            if (chat.type === 'channel') {
                status = '–ö–∞–Ω–∞–ª';
            } else if (chat.type === 'group') {
                status = '–ì—Ä—É–ø–ø–∞';
            } else if (chat.type === 'bot') {
                status = '–±–æ—Ç';
            } else {
                status = chat.online ? '–≤ —Å–µ—Ç–∏' : '–±—ã–ª –Ω–µ–¥–∞–≤–Ω–æ';
            }
            document.getElementById('currentChatStatus').innerHTML = `${status} (ID: ${chat.id})`;

            area.scrollTop = area.scrollHeight;
        }

        function openStarReactionModalWithAmount(msgId, amount) {
            document.getElementById('starReactionAmount').value = amount;
            openStarReactionModal(msgId);
        }

        function sendBotCommandMessage(command) {
            document.getElementById('messageInput').value = command;
            sendMessage();
        }

        function addReaction(chatId, msgId, emoji) {
            const chat = chats.find(c => c.id === chatId);
            const msg = chat.messages.find(m => m.id === msgId);
            
            if (!msg.reactions) msg.reactions = {};
            if (!msg.reactions[emoji]) msg.reactions[emoji] = [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ä–µ–∞–∫—Ü–∏—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userReacted = msg.reactions[emoji].includes(currentUser?.username);
            
            if (userReacted) {
                // –£–±–∏—Ä–∞–µ–º —Ä–µ–∞–∫—Ü–∏—é
                msg.reactions[emoji] = msg.reactions[emoji].filter(u => u !== currentUser?.username);
                if (msg.reactions[emoji].length === 0) {
                    delete msg.reactions[emoji];
                }
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∞–∫—Ü–∏—é
                msg.reactions[emoji].push(currentUser?.username);
            }
            
            saveToCloud();
            renderMessages();
        }

        // ========== –§–ê–ô–õ–´ ==========
        function openFileDialog() {
            document.getElementById('fileInput').click();
        }

        function sendFile(input) {
            if (!input.files || !input.files[0]) return;
            
            const file = input.files[0];
            const chat = chats.find(c => c.id === currentChatId);
            
            if (!canSendMessage(chat)) {
                alert('–ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª –≤ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª');
                return;
            }

            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

            chat.messages.push({
                id: chat.messages.length + 1,
                type: 'file',
                fileName: file.name,
                fileSize: (file.size / 1024).toFixed(1) + ' KB',
                sender: 'me',
                time: timeStr,
                date: '–°–µ–≥–æ–¥–Ω—è',
                reactions: {},
                starReactions: 0,
                edited: false
            });

            chat.lastMessage = 'üìé ' + file.name;
            chat.time = timeStr;

            renderMessages();
            renderChats();
            saveToCloud();
            
            // –û—á–∏—â–∞–µ–º input
            input.value = '';
        }

        function downloadFile(fileName) {
            alert('–°–∫–∞—á–∏–≤–∞–Ω–∏–µ: ' + fileName);
        }

        // ========== –°–¢–ò–ö–ï–†–´ ==========
        function toggleStickers() {
            const panel = document.getElementById('stickerPanel');
            const starsPanel = document.getElementById('starsPanel');
            const giftsPanel = document.getElementById('giftsPanel');
            const botsPanel = document.getElementById('botsPanel');
            const giftLinksPanel = document.getElementById('giftLinksPanel');
            const xostPanel = document.getElementById('xostPanel');
            
            starsPanel.classList.remove('active');
            giftsPanel.classList.remove('active');
            botsPanel.classList.remove('active');
            giftLinksPanel.classList.remove('active');
            xostPanel.classList.remove('active');
            panel.classList.toggle('active');
        }

        function sendSticker(sticker) {
            const chat = chats.find(c => c.id === currentChatId);
            
            if (!canSendMessage(chat)) {
                alert('–ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∏–∫–µ—Ä –≤ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª');
                return;
            }

            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

            chat.messages.push({
                id: chat.messages.length + 1,
                type: 'sticker',
                text: sticker,
                sender: 'me',
                time: timeStr,
                date: '–°–µ–≥–æ–¥–Ω—è',
                reactions: {},
                starReactions: 0,
                edited: false
            });

            chat.lastMessage = 'üòä –°—Ç–∏–∫–µ—Ä';
            chat.time = timeStr;

            renderMessages();
            renderChats();
            saveToCloud();
            
            toggleStickers();
        }

        function switchStickerTab(tab) {
            const grid = document.getElementById('stickerGrid');
            if (tab === 'animals') {
                grid.innerHTML = `
                    <div class="sticker-item" onclick="sendSticker('üê∂')">üê∂</div>
                    <div class="sticker-item" onclick="sendSticker('üê±')">üê±</div>
                    <div class="sticker-item" onclick="sendSticker('üêº')">üêº</div>
                    <div class="sticker-item" onclick="sendSticker('ü¶ä')">ü¶ä</div>
                    <div class="sticker-item" onclick="sendSticker('üê∏')">üê∏</div>
                    <div class="sticker-item" onclick="sendSticker('üê®')">üê®</div>
                    <div class="sticker-item" onclick="sendSticker('ü¶Å')">ü¶Å</div>
                    <div class="sticker-item" onclick="sendSticker('üêß')">üêß</div>
                `;
            } else if (tab === 'faces') {
                grid.innerHTML = `
                    <div class="sticker-item" onclick="sendSticker('üòä')">üòä</div>
                    <div class="sticker-item" onclick="sendSticker('üòÇ')">üòÇ</div>
                    <div class="sticker-item" onclick="sendSticker('ü•≤')">ü•≤</div>
                    <div class="sticker-item" onclick="sendSticker('üòé')">üòé</div>
                    <div class="sticker-item" onclick="sendSticker('üò≠')">üò≠</div>
                    <div class="sticker-item" onclick="sendSticker('üò°')">üò°</div>
                    <div class="sticker-item" onclick="sendSticker('üëç')">üëç</div>
                    <div class="sticker-item" onclick="sendSticker('‚ù§Ô∏è')">‚ù§Ô∏è</div>
                `;
            } else {
                grid.innerHTML = `
                    <div class="sticker-item" onclick="sendSticker('üòä')">üòä</div>
                    <div class="sticker-item" onclick="sendSticker('üòÇ')">üòÇ</div>
                    <div class="sticker-item" onclick="sendSticker('ü•≤')">ü•≤</div>
                    <div class="sticker-item" onclick="sendSticker('üòé')">üòé</div>
                    <div class="sticker-item" onclick="sendSticker('üî•')">üî•</div>
                    <div class="sticker-item" onclick="sendSticker('‚ù§Ô∏è')">‚ù§Ô∏è</div>
                    <div class="sticker-item" onclick="sendSticker('üëÄ')">üëÄ</div>
                    <div class="sticker-item" onclick="sendSticker('üê∂')">üê∂</div>
                `;
            }
        }

        // ========== –ó–í–û–ù–ö–ò ==========
        function startCall(type) {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return;
            
            currentCall = {
                type: type,
                user: chat.name,
                active: true
            };
            
            document.getElementById('callStatus').innerText = type === 'video' ? '–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫...' : '–ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫...';
            document.getElementById('callContainer').classList.add('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–µ–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            if (type === 'audio') {
                document.getElementById('remoteVideo').innerHTML = '<span style="font-size: 120px;">üéµ</span>';
                document.getElementById('localVideo').style.display = 'none';
            } else {
                document.getElementById('remoteVideo').innerHTML = '<span style="font-size: 120px;">üìπ</span>';
                document.getElementById('localVideo').style.display = 'flex';
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            callSeconds = 0;
            updateCallTimer();
            callTimer = setInterval(updateCallTimer, 1000);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–≤–æ–Ω–∫–µ –≤ —á–∞—Ç
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            
            chat.messages.push({
                id: chat.messages.length + 1,
                text: type === 'video' ? 'üìπ –í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫' : 'üìû –ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫',
                sender: 'system',
                time: timeStr,
                date: '–°–µ–≥–æ–¥–Ω—è',
                reactions: {},
                starReactions: 0,
                edited: false,
                callInfo: { type: type, duration: 0 }
            });
            
            renderMessages();
            saveToCloud();
        }

        function updateCallTimer() {
            callSeconds++;
            const mins = Math.floor(callSeconds / 60);
            const secs = callSeconds % 60;
            document.getElementById('callDuration').innerText = 
                mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        }

        function toggleMic() {
            micEnabled = !micEnabled;
            const micBtn = document.getElementById('micBtn');
            micBtn.style.opacity = micEnabled ? '1' : '0.5';
            micBtn.innerHTML = micEnabled ? 'üé§' : 'üîá';
        }

        function toggleVideo() {
            if (currentCall?.type !== 'video') return;
            
            videoEnabled = !videoEnabled;
            const videoBtn = document.getElementById('videoBtn');
            videoBtn.style.opacity = videoEnabled ? '1' : '0.5';
            
            const localVideo = document.getElementById('localVideo');
            if (videoEnabled) {
                localVideo.innerHTML = '<span style="font-size: 50px;">üë§</span>';
            } else {
                localVideo.innerHTML = '<span style="font-size: 50px;">üö´</span>';
            }
        }

        function endCall() {
            if (!currentCall) return;
            
            clearInterval(callTimer);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–≤–æ–Ω–æ–∫ –≤ —á–∞—Ç–µ
            const chat = chats.find(c => c.id === currentChatId);
            if (chat) {
                const lastMsg = chat.messages[chat.messages.length - 1];
                if (lastMsg && lastMsg.callInfo) {
                    lastMsg.callInfo.duration = callSeconds;
                    lastMsg.text = (lastMsg.callInfo.type === 'video' ? 'üìπ' : 'üìû') + 
                                  ' –ó–≤–æ–Ω–æ–∫ (' + Math.floor(callSeconds / 60) + ' –º–∏–Ω ' + (callSeconds % 60) + ' —Å–µ–∫)';
                }
                renderMessages();
                saveToCloud();
            }
            
            document.getElementById('callContainer').classList.remove('active');
            currentCall = null;
        }

        // ========== 2FA ==========
        function toggle2FA(checkbox) {
            twoFAEnabled = checkbox.checked;
            document.getElementById('twofaSetup').style.display = twoFAEnabled ? 'block' : 'none';
            
            if (!twoFAEnabled) {
                twoFAPassword = '';
            }
        }

        // ========== –°–û–ó–î–ê–ù–ò–ï –ß–ê–¢–û–í/–ö–ê–ù–ê–õ–û–í ==========
        function openCreateModal() {
            document.getElementById('createModal').classList.add('active');
        }

        function createChat() {
            const name = document.getElementById('newChatName').value;
            const username = document.getElementById('newChatUsername').value;
            const type = document.querySelector('input[name="chatType"]:checked').value;

            if (!name) return;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —é–∑–µ—Ä–Ω–µ–π–º–∞
            if (username) {
                if (!isUsernameValid(username)) {
                    document.getElementById('usernameError').innerText = '–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _';
                    return;
                }
                
                // –î–ª—è –±–æ—Ç–æ–≤ –æ—Å–æ–±–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                if (type === 'bot') {
                    if (!isBotUsernameValid(username)) {
                        document.getElementById('usernameError').innerText = '–Æ–∑–µ—Ä–Ω–µ–π–º –±–æ—Ç–∞ –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ "bot"';
                        return;
                    }
                }
                
                if (isUsernameTaken(username)) {
                    document.getElementById('usernameError').innerText = '–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç';
                    return;
                }
                takenUsernames.push(username);
            }

            let avatar, chatType, chatId;
            const isVerified = isChannelVerified(username);
            
            if (type === 'public') {
                avatar = 'üì¢';
                chatType = 'channel';
                // ID –¥–ª—è –∫–∞–Ω–∞–ª–∞: -100 + —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
                chatId = -1000000000 - Math.floor(Math.random() * 1000000);
            } else if (type === 'group') {
                avatar = 'üë•';
                chatType = 'group';
                // ID –¥–ª—è –≥—Ä—É–ø–ø—ã: -4752 + —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
                chatId = -4752000000 - Math.floor(Math.random() * 1000000);
            } else if (type === 'bot') {
                avatar = 'ü§ñ';
                chatType = 'bot';
                chatId = Math.floor(Math.random() * 1000000) + 1000;
            } else {
                avatar = 'üë§';
                chatType = 'private';
                chatId = Math.floor(Math.random() * 1000000) + 1;
            }

            const newChat = {
                id: chatId,
                type: chatType,
                name: name,
                username: username || '',
                avatar: avatar,
                lastMessage: '–ß–∞—Ç —Å–æ–∑–¥–∞–Ω',
                time: '—Ç–æ–ª—å–∫–æ —á—Ç–æ',
                unread: 0,
                online: chatType === 'bot' ? true : false,
                verified: isVerified,
                createdBy: currentUser?.username,
                messages: [
                    { 
                        id: 1, 
                        text: chatType === 'bot' ? '–ü—Ä–∏–≤–µ—Ç! –Ø –Ω–æ–≤—ã–π –±–æ—Ç. –ò—Å–ø–æ–ª—å–∑—É–π /start' : '–ß–∞—Ç —Å–æ–∑–¥–∞–Ω!', 
                        sender: chatType === 'bot' ? 'them' : 'system', 
                        time: '—Ç–æ–ª—å–∫–æ —á—Ç–æ', 
                        date: '–°–µ–≥–æ–¥–Ω—è',
                        reactions: {},
                        starReactions: 0,
                        edited: false 
                    }
                ]
            };

            // –ï—Å–ª–∏ —ç—Ç–æ –±–æ—Ç - —Å–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –≤ —Å–ø–∏—Å–∫–µ –±–æ—Ç–æ–≤
            if (chatType === 'bot') {
                const botId = 'bot_' + Date.now();
                const token = Math.random().toString(36).substring(2, 15) + ':' + Math.random().toString(36).substring(2, 30);
                
                newChat.botId = botId;
                
                const newBot = {
                    id: botId,
                    name: name,
                    username: username,
                    description: '',
                    token: token,
                    commands: [
                        { command: '/start', description: '–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞' },
                        { command: '/help', description: '–ü–æ–º–æ—â—å' }
                    ],
                    chats: 0,
                    users: 0,
                    createdBy: currentUser?.username,
                    createdAt: new Date().toISOString()
                };
                
                bots.push(newBot);
            }

            chats.push(newChat);
            
            // –ï—Å–ª–∏ —Å–æ–∑–¥–∞–ª –∫–∞–Ω–∞–ª - –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ –º–æ–∏—Ö
            if (chatType === 'channel') {
                myCreatedChats.push(newChat.id);
            }
            
            saveToCloud();
            closeModal();
            renderChats();
            selectChat(newChat.id);
        }

        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('settingsName').value = currentUser?.name || '';
            document.getElementById('settingsLastName').value = currentUser?.lastName || '';
            document.getElementById('settingsUsername').value = currentUser?.username || '';
            document.getElementById('settingsBio').value = currentUser?.bio || '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ 2FA
            const twofaToggle = document.getElementById('twofaToggle');
            if (twofaToggle) {
                twofaToggle.checked = twoFAEnabled;
                document.getElementById('twofaSetup').style.display = twoFAEnabled ? 'block' : 'none';
            }
            
            updatePremiumBadge();
            updateXostUI();
        }

        function saveSettings() {
            const newUsername = document.getElementById('settingsUsername').value;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —é–∑–µ—Ä–Ω–µ–π–º–∞ –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è
            if (newUsername !== currentUser.username) {
                if (!isUsernameValid(newUsername)) {
                    document.getElementById('settingsUsernameError').innerText = '–Æ–∑–µ—Ä–Ω–µ–π–º –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _';
                    return;
                }
                if (isUsernameTaken(newUsername)) {
                    document.getElementById('settingsUsernameError').innerText = '–≠—Ç–æ—Ç —é–∑–µ—Ä–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç';
                    return;
                }
                
                // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Å—Ç–∞—Ä—ã–π, –∑–∞–Ω–∏–º–∞–µ–º –Ω–æ–≤—ã–π
                takenUsernames = takenUsernames.filter(u => u !== currentUser.username);
                takenUsernames.push(newUsername);
                currentUser.username = newUsername;
            }

            currentUser.name = document.getElementById('settingsName').value;
            currentUser.lastName = document.getElementById('settingsLastName').value;
            currentUser.bio = document.getElementById('settingsBio').value;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º 2FA
            if (twoFAEnabled) {
                const password = document.getElementById('twofaPassword').value;
                if (password) {
                    twoFAPassword = password;
                }
            }
            
            saveToCloud();
            closeModal();
        }

        // ========== –ò–ù–§–û –ü–ê–ù–ï–õ–¨ ==========
        function openInfo() {
            document.getElementById('infoPanel').style.display = 'block';
            updateInfoPanel(chats.find(c => c.id === currentChatId));
        }

        function updateInfoPanel(chat) {
            const panel = document.getElementById('infoContent');
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–¥–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞ (–µ—Å–ª–∏ —ç—Ç–æ –ª–∏—á–Ω—ã–π —á–∞—Ç)
            let giftsHtml = '';
            if (chat.type === 'private' && currentUser?.gifts && currentUser.gifts.length > 0) {
                const userGifts = currentUser.gifts.slice(-6); // –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6 –ø–æ–¥–∞—Ä–∫–æ–≤
                giftsHtml = '<div class="info-section"><div class="info-row"><span class="info-label">–ü–æ–¥–∞—Ä–∫–∏</span></div><div class="gifts-profile">';
                userGifts.forEach(gift => {
                    giftsHtml += `
                        <div class="gift-profile-item">
                            <div class="gift-profile-icon">${gift.icon}</div>
                            <div class="gift-profile-name">${gift.name}</div>
                        </div>
                    `;
                });
                giftsHtml += '</div></div>';
            }
            
            const isVerified = chat.verified || (chat.type === 'channel' && isChannelVerified(chat.username));
            const isPremium = currentUser?.premium && new Date(currentUser.premium) > new Date();
            
            if (chat.type === 'channel') {
                panel.innerHTML = `
                    <div class="profile-avatar-large">${chat.avatar}</div>
                    <div class="profile-name">${chat.name} ${isVerified ? '‚úì' : ''}</div>
                    <div class="profile-username">${chat.username || '–Ω–µ—Ç —é–∑–µ—Ä–Ω–µ–π–º–∞'}</div>
                    <div class="profile-bio">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª</div>
                    
                    <div class="info-section">
                        <div class="info-row">
                            <span class="info-label">ID</span>
                            <span class="info-value">${chat.id}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–¢–∏–ø</span>
                            <span class="info-value">–ö–∞–Ω–∞–ª</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</span>
                            <span class="info-value">1.2K</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</span>
                            <span class="info-value">${isVerified ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</span>
                        </div>
                        ${chat.username ? `
                        <div class="info-row">
                            <span class="info-label">–°—Å—ã–ª–∫–∞</span>
                            <span class="info-value">t.me/${chat.username.substring(1)}</span>
                        </div>
                        ` : ''}
                    </div>
                    ${giftsHtml}
                `;
            } else if (chat.type === 'group') {
                panel.innerHTML = `
                    <div class="profile-avatar-large">${chat.avatar}</div>
                    <div class="profile-name">${chat.name}</div>
                    <div class="profile-username">${chat.username || '–Ω–µ—Ç —é–∑–µ—Ä–Ω–µ–π–º–∞'}</div>
                    
                    <div class="info-section">
                        <div class="info-row">
                            <span class="info-label">ID</span>
                            <span class="info-value">${chat.id}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–¢–∏–ø</span>
                            <span class="info-value">–ì—Ä—É–ø–ø–∞</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                            <span class="info-value">42</span>
                        </div>
                    </div>
                    ${giftsHtml}
                `;
            } else if (chat.type === 'bot') {
                const bot = bots.find(b => b.id === chat.botId);
                panel.innerHTML = `
                    <div class="profile-avatar-large">ü§ñ</div>
                    <div class="profile-name">${chat.name}</div>
                    <div class="profile-username">${chat.username || '–Ω–µ—Ç —é–∑–µ—Ä–Ω–µ–π–º–∞'}</div>
                    <div class="profile-bio">${bot?.description || '–ë–æ—Ç'}</div>
                    
                    <div class="info-section">
                        <div class="info-row">
                            <span class="info-label">ID</span>
                            <span class="info-value">${chat.id}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–¢–∏–ø</span>
                            <span class="info-value">–ë–æ—Ç</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">API Token</span>
                            <span class="info-value" style="font-family: monospace; font-size: 11px;">${bot?.token || '–Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–ö–æ–º–∞–Ω–¥</span>
                            <span class="info-value">${bot?.commands?.length || 0}</span>
                        </div>
                    </div>
                    
                    <button class="modal-btn bot" onclick="openBotFather()" style="width: 100%; margin-top: 10px;">ü§ñ BotFather</button>
                    ${giftsHtml}
                `;
            } else {
                panel.innerHTML = `
                    <div class="profile-avatar-large">
                        ${chat.avatar}
                        ${isPremium ? '<span class="premium-badge-large">üëë</span>' : ''}
                    </div>
                    <div class="profile-name">${chat.name}</div>
                    <div class="profile-username">${chat.username || '–Ω–µ—Ç —é–∑–µ—Ä–Ω–µ–π–º–∞'}</div>
                    
                    <div class="info-section">
                        <div class="info-row">
                            <span class="info-label">ID</span>
                            <span class="info-value">${chat.id}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–¢–∏–ø</span>
                            <span class="info-value">–õ–∏—á–Ω—ã–π —á–∞—Ç</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">–°—Ç–∞—Ç—É—Å</span>
                            <span class="info-value">${chat.online ? '–≤ —Å–µ—Ç–∏' : '–±—ã–ª –Ω–µ–¥–∞–≤–Ω–æ'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Premium</span>
                            <span class="info-value">${isPremium ? 'üëë –î–∞' : '–ù–µ—Ç'}</span>
                        </div>
                    </div>
                    ${giftsHtml}
                `;
            }
        }

        function closeInfo() {
            document.getElementById('infoPanel').style.display = 'none';
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ==========
        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
            document.getElementById('usernameError').innerText = '';
            document.getElementById('settingsUsernameError').innerText = '';
            document.getElementById('twofaError').innerText = '';
            document.getElementById('botSettingsError').innerText = '';
            window.pendingGift = null;
            window.selectedBot = null;
            currentViewingGiftLink = null;
            currentStarReactionMessage = null;
        }

        function filterChats(type) {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const items = document.querySelectorAll('.chat-item');
            
            items.forEach(item => {
                const name = item.dataset.name;
                const itemType = item.dataset.type;
                
                let showByType = true;
                if (type && type !== 'all') {
                    showByType = itemType === type;
                }
                
                const showBySearch = name.includes(search);
                
                if (showByType && showBySearch) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        }

        function getColorForUser(name) {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dfe6e9'];
            let hash = 0;
            for (let i = 0; i < name.length; i++) {
                hash = name.charCodeAt(i) + ((hash << 5) - hash);
            }
            return colors[Math.abs(hash) % colors.length];
        }

        function switchTab(tab) {
            alert('–í–∫–ª–∞–¥–∫–∞ ' + tab + ' (–¥–µ–º–æ-—Ä–µ–∂–∏–º)');
        }

        function scrollToMessage(msgId) {
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
            const msgElement = document.querySelector(`[data-msg-id="${msgId}"]`);
            if (msgElement) {
                msgElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                msgElement.style.backgroundColor = 'rgba(42, 108, 158, 0.3)';
                setTimeout(() => {
                    msgElement.style.backgroundColor = 'transparent';
                }, 2000);
            }
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        window.onload = () => {
            loadFromCloud();
            if (!currentUser) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                document.getElementById('authScreen').style.display = 'flex';
            } else {
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('mainInterface').style.opacity = '1';
                renderChats();
                selectChat(3);
                updateStarBalance();
                renderStarsGrid();
                renderGiftsGrid();
                renderGiftLinksList();
                renderXostBots();
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–ø–ª–∞—Ç—É –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            setInterval(checkXostPayments, 60000);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.stars-panel') && !e.target.closest('.star-btn') && !e.target.closest('.star-balance')) {
                    document.getElementById('starsPanel').classList.remove('active');
                }
                if (!e.target.closest('.gifts-panel') && !e.target.closest('.gift-btn')) {
                    document.getElementById('giftsPanel').classList.remove('active');
                }
                if (!e.target.closest('.sticker-panel') && !e.target.closest('.sticker-btn')) {
                    document.getElementById('stickerPanel').classList.remove('active');
                }
                if (!e.target.closest('.gift-links-panel') && !e.target.closest('.gift-link-btn') && !e.target.closest('.sidebar-icon[onclick="toggleGiftLinksPanel()"]')) {
                    document.getElementById('giftLinksPanel').classList.remove('active');
                }
                if (!e.target.closest('.bots-panel') && !e.target.closest('.bot-btn') && !e.target.closest('.sidebar-icon[onclick="toggleBotsPanel()"]')) {
                    document.getElementById('botsPanel').classList.remove('active');
                }
                if (!e.target.closest('.xost-panel') && !e.target.closest('.info-xost-btn') && !e.target.closest('.sidebar-icon[onclick="toggleXostPanel()"]')) {
                    document.getElementById('xostPanel').classList.remove('active');
                }
            });
        };
    </script>
</body>
</html>